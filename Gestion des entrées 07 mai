<!DOCTYPE html>
<html lang="fr">
<head>
  <!-- Encodage des caract√®res en UTF-8 -->
    <meta charset="UTF-8">
  <!-- Configuration de la viewport pour un rendu adaptatif -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Titre de la page affich√© dans l'onglet du navigateur -->
    <title>Gestion des Entr√©es - Kiosque</title>
 <!-- Importation de la police Roboto depuis Google Fonts --> 
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
 /* R√©initialisation des marges, paddings et utilisation de box-sizing global */     
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
        }
      
/* Style de base du corps de la page */
        body {
            background-color: #121212;
            color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
/* Style des conteneurs principaux */
        .container, .kiosk-container {
            background-color: #1e1e1e;
            border-radius: 12px;
            width: 100%;
            max-width: 1000px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

      /* Style sp√©cifique au conteneur du kiosque */
.kiosk-container {
    max-width: 600px;
    margin: 20px;
    display: none;
}

  /* Affichage par d√©faut du conteneur principal */    
.container { display: block; }

      /* Style des sections de contenu */
        .access-section, .kiosk-items-container {
            padding: 20px;
        }

  /* Style des en-t√™tes */    
        .header-content, .kiosk-header {
            background-color: #2c2c2c;
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #333;
        }
      
 /* Marge sous l'en-t√™te principal */
        .header-content { margin-bottom: 20px; }

      /* Style des titres principaux */
        h1 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

      /* Style des sous-titres */
        h2 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 10px;
        }

    /* Style du texte de sous-titre */  
        .subtitle {
            font-size: 16px;
            color: #b3b3b3;
        }

    /* Style du conteneur des prestations actuelles */  
        .current-prestations {
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #1c2526 0%, #2a3b4c 100%);
            border-radius: 8px;
            min-width: 0;
            overflow-x: auto;
        }
/* Style du filtre par jour */
        .day-filter {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

      /* Style des boutons de filtrage et d'action */
        .day-btn, .preview-btn, .add-pure-btn, .toggle-btn {
            padding: 5px 10px;
            background: #444;
            border: 1px solid #333;
            border-radius: 4px;
            cursor: pointer;
            color: white;
            transition: background-color 0.3s;
        }

      /* Positionnement du bouton de bascule */
        .toggle-btn {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 10px 20px;
        }

      /* Style du bouton d'ajout de formule bouteille */
        .add-pure-btn {
            margin-top: 20px;
            align-self: flex-start;
        }

      /* Effet de survol pour les boutons */
        .day-btn:hover, .preview-btn:hover, .add-pure-btn:hover, .toggle-btn:hover {
            background: #555;
        }

     /* Style des boutons actifs */ 
        .day-btn.active, .preview-btn.active {
            background: linear-gradient(to right, #9733EE, #DA22FF);
        }

      /* Style des √©l√©ments de prestation */
        .prestation-item, .pure-item {
            cursor: move;
            user-select: none;
            width: 100%;
            box-sizing: border-box;
            background-color: #2a3435;
            border-radius: 8px;
            margin-bottom: 10px;
            padding: 10px;
            transition: box-shadow 0.3s;
        }

     /* Style des √©l√©ments en cours de d√©placement */ 
        .prestation-item.dragging, .pure-row.dragging {
            opacity: 0.5;
        }

      /* Effet de survol pour les √©l√©ments de prestation */
        .prestation-item:hover, .pure-item:hover {
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

      /* Style des lignes d'en-t√™te et de d√©tail pour les acc√®s */
        .access-header-row, .access-detail-row, .pure-header-row, .pure-detail-row {
            display: grid;
            grid-template-columns: minmax(120px, 1fr) minmax(150px, 1fr) minmax(80px, 0.8fr) minmax(80px, 1fr) 80px;
            gap: 10px;
            padding: 5px 0;
            align-items: center;
            width: 100%;
            box-sizing: border-box;
        }

      /* Style des lignes pour les formules bouteille */
        .pure-header-row, .pure-detail-row {
            grid-template-columns: 1fr 1fr 1fr 0.5fr 0.5fr 0.8fr 1fr auto;
        }

      /* Style des lignes d'en-t√™te */
        .access-header-row, .pure-header-row {
            border-bottom: 2px solid #00D4FF;
            margin-bottom: 5px;
        }

     /* Style des lignes de d√©tail */ 
        .access-detail-row, .pure-detail-row {
            border-bottom: 1px solid #444;
            white-space: nowrap;
            overflow-x: auto;
        }

     /* Suppression de la bordure pour la derni√®re ligne */ 
        .access-detail-row:last-child, .pure-detail-row:last-child {
            border-bottom: none;
        }

      /* Style des libell√©s de prestation */
        .prestation-label {
            font-weight: 500;
            color: #00D4FF;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 16px;
            line-height: 1.2;
            position: relative;
        }

     /* Style des libell√©s dans les lignes de d√©tail */ 
        .access-detail-row .prestation-label,
        .pure-detail-row .prestation-label {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

      /* Curseur pointer au survol des libell√©s */
        .access-detail-row .prestation-label:hover,
        .pure-detail-row .prestation-label:hover {
            cursor: pointer;
        }

    /* Style du premier libell√© dans les lignes de formule bouteille */ 
        .pure-detail-row .prestation-label:nth-child(1) {
            color: #ffffff;
        }

      /* Style des valeurs de prestation */
        .prestation-value, .prestation-qty, .prestation-price, .prestation-max, .prestation-discount {
            font-size: 16px;
            color: #e0e0e0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: flex;
            align-items: center;
            padding: 0 5px;
            min-height: 20px;
            line-height: 1.2;
            position: relative;
        }
      
      /* Style des valeurs dans les lignes de d√©tail */
        .access-detail-row .prestation-value,
        .pure-detail-row .prestation-value {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

      /* Curseur pointer au survol des valeurs */
        .access-detail-row .prestation-value:hover,
        .pure-detail-row .prestation-value:hover {
            cursor: pointer;
        }

      /* Styles sp√©cifiques pour certaines valeurs */
        .prestation-value { color: #fff; }
        .prestation-qty { justify-content: flex-start; }
        .prestation-price { justify-content: flex-start; }
        .prestation-max, .prestation-discount { justify-content: center; }

      /* Style du conteneur des boutons d'action */
        .button-container {
            display: flex;
            gap: 5px;
            align-items: center;
            justify-content: flex-end;
            min-width: 80px;
        }

      /* Style des boutons d'action */
        .delete-btn, .edit-btn, .pure-duplicate-btn, .pure-delete-btn, .add-details-btn, .delete-details-btn {
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: box-shadow 0.3s, transform 0.3s;
        }

      /* Style des boutons de suppression */
        .delete-btn, .pure-delete-btn, .delete-details-btn {
            background-color: #ff4444;
            width: 22px;
            height: 22px;
            font-size: 12px;
        }

      /* Style du bouton d'√©dition */
        .edit-btn {
            background-color: #9733EE;
            width: 22px;
            height: 22px;
            font-size: 12px;
        }

     /* Style du bouton de duplication */ 
        .pure-duplicate-btn {
            background-color: #4CAF50;
            width: 21px;
            height: 21px;
            font-size: 12px;
        }

        .add-details-btn, .delete-details-btn {
            width: 30px;
            height: 30px;
            font-size: 16px;
        }

        .add-details-btn {
            background-color: #4CAF50;
            margin-top: 5px;
            align-self: center;
        }

      /* Effet de survol pour les boutons d'action */
        .delete-btn:hover, .edit-btn:hover, .pure-duplicate-btn:hover, .pure-delete-btn:hover, .add-details-btn:hover, .delete-details-btn:hover {
            box-shadow: 0 0 10px currentColor, 0 0 5px #00D4FF;
            transform: scale(1.1);
        }

      /* Effet au clic pour les boutons d'action */
        .delete-btn:active, .edit-btn:active, .pure-duplicate-btn:active, .pure-delete-btn:active, .add-details-btn:active, .delete-details-btn:active {
            transform: scale(0.95);
        }

      /* Style des formulaires */
        .access-form, .form-group {
            margin-bottom: 20px;
        }

      /* Style des √©tiquettes */
        label {
            display: block;
            margin-bottom: 3px;
            font-weight: 500;
        }

      /* Style des champs de saisie et listes d√©roulantes */
        input, select {
            padding: 10px;
            background-color: #333;
            border: 1px solid #333;
            color: white;
            border-radius: 4px;
            width: 100%;
            max-width: 300px;
            transition: background-color 0.3s, box-shadow 0.3s;
        }

      /* Effet de survol et focus pour les champs */
        input:hover, select:hover, input:focus, select:focus {
            background-color: #444;
            box-shadow: 0 0 5px #00D4FF;
            outline: none;
        }

     /* Style du conteneur des cases √† cocher pour les jours */ 
        .days-checkboxes {
            display: flex;
            gap: 15px;
            flex-wrap: nowrap;
            overflow-x: auto;
            padding: 5px;
        }

      /* Style des cases √† cocher en erreur */
        .days-checkboxes.error {
            border: 2px solid #ff4444;
            border-radius: 4px;
        }

      /* Style des √©tiquettes dans les cases √† cocher */
        .days-checkboxes label {
            display: flex;
            align-items: center;
            gap: 5px;
            white-space: nowrap;
        }

   /* Style des champs en erreur */   
        .error input, .error select {
            border: 2px solid #ff4444;
        }

     /* Style du conteneur des formules bouteille */ 
        .pure-container {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 20px;
            width: 100%;
        }

      /* Style des lignes de formule bouteille */
        .pure-row {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
            max-width: 960px;
            border-bottom: 1px solid #444;
            padding-bottom: 10px;
        }

   /* Style des sections de cat√©gorie, nom et d√©tails */   
        .category-section, .name-section, .details-row {
            display: flex;
            align-items: flex-end;
            gap: 10px;
        }

      /* Style des conteneurs dans les sections */
        .category-section div, .name-section div, .details-row div {
            display: flex;
            flex-direction: column;
        }

     /* Style de la section des d√©tails */ 
        .details-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

      /* Style des champs de saisie sp√©cifiques pour les formules bouteille */
        .pure-row input.pure-name, .pure-row input.pure-custom-category, .pure-row input[list="bottle-categories"],
        .details-row input.pure-name {
            width: 220px;
            max-width: none;
        }

     /* Style des champs de saisie pour quantit√©s, prix, etc. */ 
        .pure-row input.pure-qty, .pure-row input.pure-price, .pure-row input.pure-max-entries, .pure-row input.pure-discount,
        .details-row input.pure-qty, .details-row input.pure-price, .details-row input.pure-max-entries, .details-row input.pure-discount,
        .presentation-fields input#access-price, .presentation-fields .sex-container select {
            width: 150px;
            max-width: none;
        }

     /* Style des groupes de formulaire */ 
        .presentation-group, .pure-group {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            position: relative;
        }

     /* Style des titres dans les groupes */ 
        .presentation-group h3, .pure-group h3 {
            margin-bottom: 15px;
            font-size: 18px;
        }

     /* Ligne d√©corative avant les groupes */ 
        .presentation-group::before, .pure-group::before {
            content: '';
            position: absolute;
            top: -10px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: #00D4FF;
        }

      /* Style des champs de pr√©sentation */
        .presentation-fields {
            display: flex;
            justify-content: flex-start;
            width: 100%;
            gap: 10px;
            flex-wrap: wrap;
        }

    /* Style des conteneurs dans les champs de pr√©sentation */  
        .presentation-fields div {
            flex: 1;
            min-width: 220px;
        }

      /* Style des conteneurs sp√©cifiques pour prix et sexe */
        .presentation-fields .price-container, .presentation-fields .sex-container {
            flex: none;
            min-width: auto;
        }

      /* Style des champs dans les champs de pr√©sentation */
        .presentation-fields input, .presentation-fields select {
            width: 100%;
            max-width: none;
        }

      /* Style des boutons d'enregistrement et de validation */
        .save-btn, .kiosk-checkout-btn {
            padding: 15px;
            background: linear-gradient(to right, #9733EE, #DA22FF);
            color: white;
            border: 1px solid #333;
            border-radius: 6px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: box-shadow 0.3s;
            width: 100%;
        }

    /* Marge pour le bouton d'enregistrement */  
        .save-btn {
            margin: 20px 0;
        }

      /* Effet de survol pour le bouton d'enregistrement */
        .save-btn:hover {
            box-shadow: 0 0 10px #9733EE, 0 0 5px #00D4FF;
        }

   /* Style du bouton de validation du kiosque */   
        .kiosk-checkout-btn {
            transition: opacity 0.2s;
            border: none;
        }

    /* Effets de survol et clic pour le bouton de validation */  
        .kiosk-checkout-btn:hover { opacity: 0.9; }
        .kiosk-checkout-btn:active { opacity: 0.8; }
        .kiosk-checkout-btn:disabled {
            background: #444;
            opacity: 0.6;
            cursor: not-allowed;
        }

      /* Style du tableau d'aper√ßu */
        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: linear-gradient(135deg, #2a3435 0%, #3b4c5d 100%);
            border: 1px solid #FF00FF;
        }

     /* Style des cellules du tableau */ 
        .preview-table th, .preview-table td {
            padding: 10px;
            border: 1px solid #555;
            text-align: left;
            vertical-align: top;
        }

      /* Style des en-t√™tes du tableau */
        .preview-table th {
            background-color: #444;
            font-weight: 700;
            border-bottom: 2px solid #00D4FF;
        }

    /* Style des cellules de jour */  
        .preview-table .day-cell {
            cursor: pointer;
            transition: box-shadow 0.3s;
        }

    /* Effet de survol pour les cellules de jour */  
        .preview-table .day-cell:hover {
            box-shadow: 0 0 5px #00D4FF;
        }

      /* Style des lignes de jours impairs */
        .preview-table .day-lundi, .preview-table .day-mercredi,
        .preview-table .day-vendredi, .preview-table .day-dimanche {
            background-color: rgba(255, 255, 255, 0.05);
        }

      /* Style des lignes de jours pairs */
        .preview-table .day-mardi, .preview-table .day-jeudi,
        .preview-table .day-samedi {
            background-color: rgba(0, 0, 0, 0.05);
        }

      /* Style du s√©parateur dans le kiosque */
        .kiosk-separator {
            width: 70%;
            height: 2px;
            background-color: #ffffff;
            margin: 20px auto;
        }

    /* Style des √©l√©ments du kiosque */  
        .kiosk-item {
            padding: 15px 0;
            border-bottom: 1px solid #333;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
        }

     /* Suppression de la bordure pour le dernier √©l√©ment */ 
        .kiosk-item:last-child { border-bottom: none; }

      /* Style du contenu des √©l√©ments du kiosque */
        .kiosk-item-content {
            display: grid;
            grid-template-columns: 1fr 120px 140px;
            align-items: center;
            gap: 10px;
            width: 100%;
        }

      /* Style de la cat√©gorie dans le kiosque */
        .kiosk-item-category {
            color: #00D4FF;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }

     /* Style du nom dans le kiosque */ 
        .kiosk-item-name {
            font-size: 18px;
            font-weight: 500;
            text-align: left;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: normal;
            word-wrap: break-word;
            max-width: 100%;
            line-height: 1.2;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

      /* Style du conteneur de prix dans le kiosque */
        .kiosk-item-price-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            min-width: 120px;
            max-width: 120px;
            white-space: nowrap;
        }

     /* Style du prix dans le kiosque */ 
        .kiosk-item-price {
            font-size: 16px;
            color: #b3b3b3;
            margin-bottom: 5px;
            text-align: center;
        }

      /* Style du maximum d'entr√©es dans le kiosque */
        .kiosk-item-max {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #b3b3b3;
            font-size: 14px;
            white-space: nowrap;
        }

      /* Style de la valeur du maximum d'entr√©es */
        .kiosk-max-value { font-weight: 600; color: #e0e0e0; }
        .kiosk-max-label { font-size: 14px; }

      /* Style des contr√¥les de quantit√© dans le kiosque */
        .kiosk-quantity-control {
            display: flex;
            align-items: center;
            gap: 5px;
            justify-content: flex-end;
            min-width: 140px;
            max-width: 140px;
        }

     /* Style des boutons de quantit√© */ 
        .kiosk-qty-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background-color: #333;
            color: white;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.2s;
        }

      /* Effets de survol et clic pour les boutons de quantit√© */
        .kiosk-qty-btn:hover { background-color: #444; }
        .kiosk-qty-btn:active { background-color: #555; }

     /* Style de la valeur de quantit√© */ 
        .kiosk-qty-value {
            width: 40px;
            text-align: center;
            font-size: 18px;
        }

      /* Style de la section de total dans le kiosque */
        .kiosk-total-section {
            background-color: #2c2c2c;
            padding: 20px;
            border-top: 1px solid #333;
        }

   /* Style de la ligne de total */   
        .kiosk-total-row {
            display: flex;
            justify-content: space-between;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
        }

    /* Style de la r√©duction dans le total */  
        .kiosk-total-discount {
            color: #ff4444;
            font-style: italic;
        }

   /* Style des titres de cat√©gorie dans le kiosque */   
        .kiosk-category h2 {
            text-align: center;
        }

    /* Style des lignes paires et impaires */  
        .even-row { background-color: rgba(255, 255, 255, 0.05); }
        .odd-row { background-color: rgba(0, 0, 0, 0.1); }

      /* Style des ic√¥nes d'infobulle */
        .tooltip-icon {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 16px;
            height: 16px;
            background-color: #2a2a2a; /* Nuance proche du fond #1e1e1e */
            color: #b3b3b3; /* Gris clair pour le texte */
            border-radius: 50%;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            margin-left: 5px;
            vertical-align: middle;
            transition: background-color 0.3s;
        }

      /* Effet de survol pour les ic√¥nes d'infobulle */
        .tooltip-icon:hover {
            background-color: #3a3a3a; /* L√©g√®re variation au survol */
        }

        .tooltip {
            position: absolute;
            background-color: #333;
            color: #fff;
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
            z-index: 10;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
            display: none;
            max-width: 300px;
            pointer-events: none;
            white-space: normal;
            line-height: 1.4;
        }

      /* Style de l'infobulle visible */
        .tooltip.visible {
            display: block;
        }

      /* Style de l'√©diteur de maximum d'entr√©es */
.max-entries-editor {
    position: absolute;
    background: #333;
    color: #fff;
    padding: 15px;
    border-radius: 8px;
    z-index: 100;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
    min-width: 250px;
    max-width: 300px;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    gap: 12px;
    border: 1px solid #444;
}

      /* Style des √©tiquettes dans l'√©diteur */
.max-entries-editor label {
    font-size: 14px;
    font-weight: 500;
    margin-bottom: 5px;
}

   /* Style du conteneur des entr√©es dans l'√©diteur */   
.max-entries-editor #max-entries-inputs {
    max-height: 120px;
    overflow-y: auto;
    flex-grow: 1;
}

      /* Style des lignes dans l'√©diteur */
.max-entries-editor .max-entry-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    font-size: 14px;
}

      /* Style des champs de saisie dans l'√©diteur */
.max-entries-editor input {
    width: 70px;
    padding: 5px;
    background-color: #444;
    border: 1px solid #555;
    color: white;
    border-radius: 4px;
    font-size: 14px;
}

      /* Style des champs de saisie en focus dans l'√©diteur */
.max-entries-editor input:focus {
    outline: none;
    border-color: #00D4FF;
    box-shadow: 0 0 3px #00D4FF;
}

    /* Style des boutons dans l'√©diteur */  
.max-entries-editor .editor-buttons {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    padding-top: 10px;
    border-top: 1px solid #444;
}

      /* Style des boutons d'action dans l'√©diteur */
.max-entries-editor button {
    padding: 6px 12px;
    background: #9733EE;
    border: none;
    color: white;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    transition: background-color 0.3s;
}

    /* Effet de survol pour les boutons de l'√©diteur */  
.max-entries-editor button:hover {
    background: #DA22FF;
}
      /* Media query pour les √©crans de 768px et moins */
        @media (max-width: 768px) {
          /* Ajustement des grilles pour les lignes d'acc√®s et de formule bouteille */
            .access-header-row, .access-detail-row, .pure-header-row, .pure-detail-row {
                grid-template-columns: 1fr;
                gap: 5px;
            }

          /* Alignement √† gauche pour les valeurs */
            .prestation-label, .prestation-value, .prestation-qty,
            .prestation-price, .prestation-max, .prestation-discount {
                text-align: left;
            }

          /* Disposition en colonne pour les sections */
            .pure-row, .details-row, .category-section, .name-section,
            .presentation-fields {
                flex-direction: column;
                align-items: flex-start;
            }

        /* Largeur pleine pour les conteneurs des sections */  
            .category-section div, .name-section div {
                width: 100%;
            }

          /* Largeur pleine pour les champs */
            input, select {
                max-width: 100%;
            }

         /* Espacement r√©duit pour le filtre de jour */ 
            .day-filter { gap: 5px; }

          /* Largeur pleine pour les champs de pr√©sentation */
            .presentation-fields div, .presentation-fields .price-container,
            .presentation-fields .sex-container {
                min-width: 100%;
            }

          /* Largeur maximale pour certains champs */
            .presentation-fields input#access-price, .presentation-fields .sex-container select {
                max-width: 150px;
            }

          /* Largeur maximale pour les champs de nom et cat√©gorie */
            .pure-row input.pure-name, .pure-row input.pure-custom-category,
            .pure-row input[list="bottle-categories"], .details-row input.pure-name {
                max-width: 220px;
            }

          /* Largeur maximale pour les champs de quantit√©, prix, etc. */
            .pure-row input.pure-qty, .pure-row input.pure-price,
            .pure-row input.pure-max-entries, .pure-row input.pure-discount,
            .details-row input.pure-qty, .details-row input.pure-price,
            .details-row input.pure-max-entries, .details-row input.pure-discount {
                max-width: 150px;
            }

          /* Disposition en colonne pour le contenu du kiosque */
            .kiosk-item-content {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 5px;
            }

        /* Centrage du nom dans le kiosque */  
            .kiosk-item-name {
                max-width: 100%;
                text-align: center;
                -webkit-line-clamp: 3;
                display: -webkit-box;
                -webkit-box-orient: vertical;
            }

       /* Ajustement de la largeur du conteneur de prix */   
            .kiosk-item-price-container {
                min-width: 100px;
                max-width: 100px;
                margin: 5px 0;
            }

        /* Ajustement de la largeur des contr√¥les de quantit√© */  
            .kiosk-quantity-control {
                min-width: 120px;
                max-width: 120px;
                justify-content: center;
            }

          /* Disposition en ligne pour le maximum d'entr√©es */
            .kiosk-item-max {
                flex-direction: row;
                justify-content: center;
                width: 100%;
            }

          /* Centrage du prix dans le kiosque */
            .kiosk-item-price {
                text-align: center;
            }

          /* Centrage des titres de cat√©gorie */
            .kiosk-category h2 {
                text-align: center;
            }
        }
    </style>
</head>
<body>
  <!-- Conteneur principal du tableau de bord -->
    <div class="container" id="dashboard">
      <!-- Section de gestion des acc√®s -->
        <div class="access-section">
          <!-- En-t√™te du tableau de bord -->
            <div class="header-content">
                <h1>Gestion des entr√©es</h1>
                <div class="subtitle">Configurez vos formules d'entr√©e</div>
            </div>
            
          <!-- Conteneur des prestations actuelles -->
            <div class="current-prestations">
                <h2>Prestations actuelles</h2>
              <!-- Filtre par jour -->
                <div class="day-filter" id="day-filter">
                    <button class="day-btn" onclick="filterByDay('Lundi')">Lundi</button>
                    <button class="day-btn" onclick="filterByDay('Mardi')">Mardi</button>
                    <button class="day-btn" onclick="filterByDay('Mercredi')">Mercredi</button>
                    <button class="day-btn" onclick="filterByDay('Jeudi')">Jeudi</button>
                    <button class="day-btn" onclick="filterByDay('Vendredi')">Vendredi</button>
                    <button class="day-btn" onclick="filterByDay('Samedi')">Samedi</button>
                    <button class="day-btn" onclick="filterByDay('Dimanche')">Dimanche</button>
                    <button class="preview-btn" onclick="showPreview()">Aper√ßu</button>
                </div>
              <!-- Liste des prestations d'acc√®s -->
                <div class="prestation-container" id="access-prestations-list"></div>
              <!-- Ligne de s√©paration -->
                <div id="separator-line" class="separator-line" style="display: none;"></div>
              <!-- Liste des prestations de formule bouteille -->
                <div class="prestation-container" id="pure-prestations-list"></div>
              <!-- Section d'aper√ßu -->
                <div id="preview-section" style="display: none;"></div>
            </div>
            
          <!-- Formulaire de configuration des acc√®s -->
            <div class="access-form" id="access-form">
              <!-- Groupe de s√©lection des jours -->
                <div class="form-group">
                    <label>Jour(s)</label>
                    <div class="days-checkboxes" id="days-checkboxes">
                        <label><input type="checkbox" name="days" value="Lundi"> Lundi</label>
                        <label><input type="checkbox" name="days" value="Mardi"> Mardi</label>
                        <label><input type="checkbox" name="days" value="Mercredi"> Mercredi</label>
                        <label><input type="checkbox" name="days" value="Jeudi"> Jeudi</label>
                        <label><input type="checkbox" name="days" value="Vendredi"> Vendredi</label>
                        <label><input type="checkbox" name="days" value="Samedi"> Samedi</label>
                        <label><input type="checkbox" name="days" value="Dimanche"> Dimanche</label>
                    </div>
                </div>
 
              <!-- Groupe des champs de pr√©sentation des entr√©es -->
<div class="form-group presentation-group">
    <h3>Les entr√©es</h3>
    <div class="presentation-fields">
        <div>
            <label>Entr√©e sans Boisson: <span class="tooltip-icon" data-tooltip="TVA incluse, personnalisez dans Configuration > Mode de paiement et caisse > Param√®tres de caisse > Param√®tres des taxes. L'outil 'Statistique et rapport' calcule automatiquement le prix HT et la TVA √† partir du prix TTC saisi.">i</span></label>
            <input type="text" placeholder="Ex: Entr√©e seule" id="access-presentation-normal">
        </div>
        <div>
            <label>Entr√©e + Alcool: <span class="tooltip-icon" data-tooltip="TVA incluse, personnalisez dans Configuration > Mode de paiement et caisse > Param√®tres de caisse > Param√®tres des taxes. L'outil 'Statistique et rapport' calcule automatiquement le prix HT et la TVA √† partir du prix TTC saisi.">i</span></label>
            <input type="text" placeholder="Ex: Entr√©e avec boisson alcoolis√©e" id="access-presentation-alcohol">
        </div>
        <div>
            <label>Heure Creuse: <span class="tooltip-icon" data-tooltip="TVA incluse, personnalisez dans Configuration > Mode de paiement et caisse > Param√®tres de caisse > Param√®tres des taxes. L'outil 'Statistique et rapport' calcule automatiquement le prix HT et la TVA √† partir du prix TTC saisi.">i</span></label>
            <input type="text" placeholder="Ex: Entr√©e Gratuit" id="access-presentation-low">
        </div>
        <div>
            <label>Entr√©e + Soft: <span class="tooltip-icon" data-tooltip="TVA incluse, personnalisez dans Configuration > Mode de paiement et caisse > Param√®tres de caisse > Param√®tres des taxes. L'outil 'Statistique et rapport' calcule automatiquement le prix HT et la TVA √† partir du prix TTC saisi.">i</span></label>
            <input type="text" placeholder="Ex: Entr√©e avec boisson soft" id="access-presentation-soft">
        </div>
        <div class="price-container">
            <label>Prix</label>
            <input type="number" step="0.01" min="0" placeholder="Prix (‚Ç¨)" id="access-price">
        </div>
        <div class="sex-container">
            <label>Sexe</label>
            <select id="access-sex">
                <option value="Homme"><span style="color: #00D4FF;">‚ôÇ</span> Homme</option>
                <option value="Femme"><span style="color: #FF00FF;">‚ôÄ</span> Femme</option>
                <option value="H/F" selected><span style="color: #00D4FF;">‚ôÇ</span>/<span style="color: #FF00FF;">‚ôÄ</span> H/F</option>
            </select>
        </div>
    </div>
</div>
                
     <!-- Groupe des formules bouteille -->         
                <div class="form-group pure-group">
                    <h3>Les entr√©es avec bouteille <span class="tooltip-icon" data-tooltip="TVA incluse, personnalisez dans Configuration > Mode de paiement et caisse > Param√®tres de caisse > Param√®tres des taxes. L'outil 'Statistique et rapport' calcule automatiquement le prix HT et la TVA √† partir du prix TTC saisi.">i</span></h3>
<div class="pure-container" id="pure-container">
    <!-- La ligne "Formule Bouteille" sera ajout√©e dynamiquement via addPure() -->
</div>
                    <div class="add-pure-btn" onclick="addPure()">+ Ajouter une formule bouteille</div>
                </div>
            </div>
            
         <!-- Bouton pour enregistrer les modifications --> 
            <button class="save-btn" onclick="savePrestation()">Enregistrer les modifications</button>
        </div>
    </div>

  <!-- Conteneur du kiosque -->
    <div class="kiosk-container" id="kiosk">
        <div class="kiosk-header">
            <h1>KIOSQUE</h1>
            <div class="subtitle" id="kiosk-subtitle"></div>
        </div>
      
      <!-- Conteneur des √©l√©ments du kiosque -->        
        <div class="kiosk-items-container">
            <div class="kiosk-category" id="access-soiree">
                <h2>Acc√®s Soir√©e</h2>
                <div id="access-items"></div>
            </div>
            <div class="kiosk-separator"></div>
            <div class="kiosk-category" id="pure-soiree">
                <h2>Pure Soir√©e</h2>
                <div id="pure-items"></div>
            </div>
        </div>
        
   <!-- Section du total dans le kiosque -->   
        <div class="kiosk-total-section">
          <!-- Ligne affichant la r√©duction et le total -->
            <div class="kiosk-total-row">
                <div id="kiosk-total-discount"></div>
                <div id="kiosk-total-price">0‚Ç¨</div>
            </div>
          <!-- Bouton pour valider la s√©lection -->
            <button id="kiosk-checkout-btn" class="kiosk-checkout-btn" disabled>VALIDER</button>
        </div>
    </div>

  <!-- Bouton pour basculer entre tableau de bord et kiosque -->
<button class="toggle-btn" id="toggle-btn" onclick="toggleInterface()">Passer au Kiosque</button>

    <script>
        let prestations = [];
        let selectedDayFilter = null;
        let isPreviewActive = false;
        let kioskItems = {};

        function addPure() {
            const container = document.getElementById('pure-container');
            const pureDiv = document.createElement('div');
            pureDiv.className = 'pure-row';
            pureDiv.draggable = true;
            pureDiv.innerHTML = `
            <!-- Section de cat√©gorie -->
         
                <div class="category-section">
                    <div>
                        <label>Cat√©gorie de bouteille (optionnel)</label>
                        <input type="text" list="bottle-categories" placeholder="Saisir ou s√©lectionner une cat√©gorie" class="pure-category-input">
                        <datalist id="bottle-categories">
                            <option value="VODKA">
                            <option value="WHISKY">
                            <option value="RUM">
                            <option value="J√ÑGERBOMB">
                            <option value="CHAMPAGNE">
                        </datalist>
                    </div>
                </div>
    <!-- Section des d√©tails principaux -->            
                <div class="name-section">
                    <div>
                        <label>Nom</label>
                        <input type="text" placeholder="Ex: Bouteille" class="pure-name">
                    </div>
                    <div>
                        <label>Qt. bouteilles</label>
                        <input type="number" min="1" placeholder="Quantit√©" class="pure-qty">
                    </div>
                    <div>
                        <label>Prix</label>
                        <input type="number" step="0.01" min="0" placeholder="Prix (‚Ç¨)" class="pure-price">
                    </div>
                    <div>
                        <label>Max. Entr√©e</label>
                        <input type="text" placeholder="Cliquez pour d√©finir" class="pure-max-entries" readonly onclick="showMaxEntriesEditor(this)">
                    </div>
                    <div>
                        <label>R√©duc. bouteille suppl.</label>
                        <input type="number" step="0.01" min="0" placeholder="R√©duction (‚Ç¨)" class="pure-discount">
                    </div>
                    <button class="pure-duplicate-btn" onclick="duplicatePure(this)">üìã</button>
                    <button class="pure-delete-btn" onclick="deletePure(this)">üóëÔ∏è</button>
                </div>
                <div class="details-section">
                    <button class="add-details-btn" onclick="addDetails(this)">+</button>
                </div>
            `;
            container.appendChild(pureDiv);
            addDragEvents(pureDiv);
        }
    </script>
</body>
<script>
  // Fonction pour ajouter une ligne de d√©tails suppl√©mentaires
    function addDetails(button) {
        const detailsSection = button.parentElement;
        const pureRow = detailsSection.parentElement;
        const nameSection = pureRow.querySelector('.name-section');
        const lastDetailsRow = detailsSection.querySelector('.details-row:last-child') || nameSection;

        const newDetailsRow = document.createElement('div');
        newDetailsRow.className = 'details-row';

  // Copier les valeurs de la derni√®re ligne ou de la section principale    
        const sourceMaxEntries = lastDetailsRow.querySelector('.pure-max-entries')?.dataset.maxEntries || JSON.stringify({ 1: 1 });

        newDetailsRow.innerHTML = `
            <div>
                <label>Nom</label>
                <input type="text" value="${lastDetailsRow.querySelector('.pure-name')?.value || ''}" class="pure-name">
            </div>
            <div>
                <label>Qt. bouteilles</label>
                <input type="number" min="1" value="${lastDetailsRow.querySelector('.pure-qty')?.value || ''}" class="pure-qty">
            </div>
            <div>
                <label>Prix</label>
                <input type="number" step="0.01" min="0" value="${lastDetailsRow.querySelector('.pure-price')?.value || ''}" class="pure-price">
            </div>
            <div>
                <label>Max. Entr√©e</label>
                <input type="text" placeholder="Cliquez pour d√©finir" class="pure-max-entries" readonly onclick="showMaxEntriesEditor(this)" 
                       data-max-entries='${sourceMaxEntries}'>
            </div>
            <div>
                <label>R√©duc. bouteille suppl.</label>
                <input type="number" step="0.01" min="0" value="${lastDetailsRow.querySelector('.pure-discount')?.value || ''}" class="pure-discount">
            </div>
            <button class="delete-details-btn" onclick="deleteDetails(this)">üóëÔ∏è</button>
        `;

        detailsSection.insertBefore(newDetailsRow, button);
      
// Configurer la valeur du champ Max. Entr√©e
        const newMaxInput = newDetailsRow.querySelector('.pure-max-entries');
        const sourceMaxInput = lastDetailsRow.querySelector('.pure-max-entries');
        if (sourceMaxInput && sourceMaxInput.dataset.maxEntries) {
            newMaxInput.value = sourceMaxInput.value || 'Cliquez pour d√©finir';
        } else {
            newMaxInput.value = '1=1';
        }
    }

 // Fonction pour supprimer une ligne de d√©tails 
    function deleteDetails(button) {
        button.parentElement.remove();
    }

  // Fonction pour dupliquer une ligne de formule bouteille
    function duplicatePure(button) {
        const container = document.getElementById('pure-container');
        const originalRow = button.parentElement.parentElement;
        const newRow = originalRow.cloneNode(true);
        const categoryInput = newRow.querySelector('.pure-category-input');
        const originalCategory = originalRow.querySelector('.pure-category-input').value;

        categoryInput.value = originalCategory;

     // R√©initialiser les gestionnaires d'√©v√©nements pour la nouvelle ligne 
        newRow.querySelector('.pure-duplicate-btn').onclick = () => duplicatePure(newRow.querySelector('.pure-duplicate-btn'));
        newRow.querySelector('.pure-delete-btn').onclick = () => deletePure(newRow.querySelector('.pure-delete-btn'));
        newRow.querySelector('.add-details-btn').onclick = () => addDetails(newRow.querySelector('.add-details-btn'));

        newRow.querySelectorAll('.delete-details-btn').forEach(btn => {
            btn.onclick = () => deleteDetails(btn);
        });

        newRow.querySelectorAll('.pure-max-entries').forEach(input => {
            input.onclick = () => showMaxEntriesEditor(input);
        });

        container.appendChild(newRow);
        addDragEvents(newRow);
    }

  // Fonction pour supprimer une ligne de formule bouteille
    function deletePure(button) {
        const container = document.getElementById('pure-container');
        button.parentElement.parentElement.remove();
        if (container.children.length === 0) addPure();
    }

  // Fonction pour ajouter les √©v√©nements de glisser-d√©poser √† une ligne
    function addDragEvents(pureDiv) {
        pureDiv.addEventListener('dragstart', handlePureDragStart);
        pureDiv.addEventListener('dragover', handlePureDragOver);
        pureDiv.addEventListener('drop', handlePureDrop);
        pureDiv.addEventListener('dragend', handlePureDragEnd);
    }

    let draggedPure = null;

  // Gestionnaire d'√©v√©nement pour le d√©but du glisser
    function handlePureDragStart(e) {
        draggedPure = this;
        this.classList.add('dragging');
        e.dataTransfer.effectAllowed = 'move';
        e.dataTransfer.setData('text/html', this.innerHTML);
    }

  // Gestionnaire d'√©v√©nement pour le survol pendant le glisser
    function handlePureDragOver(e) {
        e.preventDefault();
        e.dataTransfer.dropEffect = 'move';
    }

  // Gestionnaire d'√©v√©nement pour le d√©p√¥t
    function handlePureDrop(e) {
        e.preventDefault();
        if (draggedPure !== this) {
            const allPure = [...document.querySelectorAll('.pure-row')];
            const draggedIndex = allPure.indexOf(draggedPure);
            const droppedIndex = allPure.indexOf(this);
            const container = document.getElementById('pure-container');
            const pureArray = Array.from(container.children);
            const [movedPure] = pureArray.splice(draggedIndex, 1);
            pureArray.splice(droppedIndex, 0, movedPure);
            container.innerHTML = '';
            pureArray.forEach(pure => {
                container.appendChild(pure);
                addDragEvents(pure);
            });
        }
    }

  // Gestionnaire d'√©v√©nement pour la fin du glisser
    function handlePureDragEnd() {
        this.classList.remove('dragging');
        draggedPure = null;
    }

  // Fonction pour afficher l'√©diteur de maximum d'entr√©es
function showMaxEntriesEditor(input) {
    let editor = input.parentElement.querySelector('.max-entries-editor');
    if (!editor) {
        editor = document.createElement('div');
        editor.className = 'max-entries-editor';
        editor.innerHTML = `
            <label>D√©finir Max. Entr√©e par Qt. bouteilles:</label><br>
            <div id="max-entries-inputs">
                <div>1 bouteille: <input type="number" min="1" class="max-entry-input" data-qty="1"></div>
                <div>2 bouteilles: <input type="number" min="1" class="max-entry-input" data-qty="2"></div>
            </div>
            <button onclick="addMaxEntryInput(this)">+ Ajouter</button>
            <button onclick="saveMaxEntries(this)">OK</button>
        `;
        input.parentElement.appendChild(editor);

      // Positionnement de l'√©diteur
        const rect = input.getBoundingClientRect();
        const parentRect = input.offsetParent.getBoundingClientRect();
        const scrollTop = window.scrollY || window.pageYOffset;
        const scrollLeft = window.scrollX || window.pageXOffset;

        editor.style.position = 'absolute';
        editor.style.top = `${rect.bottom + scrollTop}px`;
        editor.style.left = `${rect.left + scrollLeft}px`;

        const offsetTopAdjustment = parentRect.top + scrollTop;
        const offsetLeftAdjustment = parentRect.left + scrollLeft;
        editor.style.top = `${parseInt(editor.style.top) - offsetTopAdjustment}px`;
        editor.style.left = `${parseInt(editor.style.left) - offsetLeftAdjustment}px`;

        const editorRect = editor.getBoundingClientRect();
        const viewportHeight = window.innerHeight;
        const viewportWidth = window.innerWidth;

        if (editorRect.bottom > viewportHeight) {
            editor.style.top = `${parseInt(editor.style.top) - (editorRect.bottom - viewportHeight) - 10}px`;
        }
        if (editorRect.right > viewportWidth) {
            editor.style.left = `${parseInt(editor.style.left) - (editorRect.right - viewportWidth) - 5}px`;
        }

        if (input.dataset.maxEntries) {
            const maxEntries = JSON.parse(input.dataset.maxEntries);
            const inputsContainer = editor.querySelector('#max-entries-inputs');
            inputsContainer.innerHTML = '';
            for (const [qty, max] of Object.entries(maxEntries)) {
                const newInput = document.createElement('div');
                newInput.innerHTML = `${qty} bouteilles: <input type="number" min="1" class="max-entry-input" data-qty="${qty}" value="${max}">`;
                inputsContainer.appendChild(newInput);
            }
        }
    }
    editor.style.display = editor.style.display === 'none' ? 'block' : 'none';
}
  
  // Fonction pour ajouter un nouveau champ dans l'√©diteur de maximum d'entr√©es
    function addMaxEntryInput(button) {
        const inputsContainer = button.parentElement.querySelector('#max-entries-inputs');
        const existingQtys = Array.from(inputsContainer.querySelectorAll('.max-entry-input')).map(input => parseInt(input.dataset.qty));
        const nextQty = Math.max(...existingQtys, 0) + 1;
        const newInput = document.createElement('div');
        newInput.innerHTML = `${nextQty} bouteilles: <input type="number" min="1" class="max-entry-input" data-qty="${nextQty}">`;
        inputsContainer.appendChild(newInput);
    }

  // Fonction pour sauvegarder les valeurs de l'√©diteur
    function saveMaxEntries(button) {
        const editor = button.parentElement;
        const inputs = editor.querySelectorAll('.max-entry-input');
        const maxEntries = {};
        inputs.forEach(input => {
            const value = parseInt(input.value);
            if (!isNaN(value) && value >= 1) {
                maxEntries[input.dataset.qty] = value;
            }
        });
        const inputField = editor.parentElement.querySelector('.pure-max-entries');
        inputField.dataset.maxEntries = JSON.stringify(maxEntries);
        inputField.value = Object.entries(maxEntries).length > 0 ? Object.entries(maxEntries).map(([qty, max]) => `${qty}=${max}`).join(', ') : 'Cliquez pour d√©finir';
        editor.style.display = 'none';
    }

  // Cacher l'√©diteur si clic en dehors
    document.addEventListener('click', (e) => {
        const editors = document.querySelectorAll('.max-entries-editor');
        editors.forEach(editor => {
            if (!editor.contains(e.target) && !editor.parentElement.querySelector('.pure-max-entries').contains(e.target)) {
                editor.style.display = 'none';
            }
        });
    });

  // Fonction de validation des champs des acc√®s soir√©e
    function validateAccessSoiree() {
        const presentationLow = document.getElementById('access-presentation-low');
        const presentationNormal = document.getElementById('access-presentation-normal');
        const presentationAlcohol = document.getElementById('access-presentation-alcohol');
        const presentationSoft = document.getElementById('access-presentation-soft');
        const price = document.getElementById('access-price');
        presentationLow.classList.remove('error');
        presentationNormal.classList.remove('error');
        presentationAlcohol.classList.remove('error');
        presentationSoft.classList.remove('error');
        price.classList.remove('error');
        const hasPresentation = presentationLow.value.trim() || presentationNormal.value.trim() || 
                               presentationAlcohol.value.trim() || presentationSoft.value.trim();
        const hasPrice = price.value !== '';
        let errors = [];
        if (hasPresentation && !hasPrice) {
            errors.push('Veuillez remplir le champ "Prix" dans "Les entr√©es" si une pr√©sentation est indiqu√©e.');
            price.classList.add('error');
        }
        if (hasPrice && !hasPresentation) {
            errors.push('Veuillez remplir au moins une "Pr√©sentation" dans "Les entr√©es" si un prix est indiqu√©.');
            presentationLow.classList.add('error');
            presentationNormal.classList.add('error');
            presentationAlcohol.classList.add('error');
            presentationSoft.classList.add('error');
        }
        return { isValid: (hasPresentation && hasPrice), errors };
    }

  // Fonction de validation des champs des formules bouteille
    function validatePureSoiree() {
        const pureRows = document.querySelectorAll('.pure-row');
        let errors = [];
        let hasValidRow = false;

        pureRows.forEach((row, index) => {
            const categoryInput = row.querySelector('.pure-category-input');
            const name = row.querySelector('.name-section .pure-name');
            const firstQty = row.querySelector('.name-section .pure-qty');
            const firstPrice = row.querySelector('.name-section .pure-price');
            const firstMaxEntries = row.querySelector('.name-section .pure-max-entries');
            const firstDiscount = row.querySelector('.name-section .pure-discount');

            categoryInput.classList.remove('error');
            name.classList.remove('error');
            firstQty.classList.remove('error');
            firstPrice.classList.remove('error');
            firstMaxEntries.classList.remove('error');
            firstDiscount.classList.remove('error');

            const additionalDetails = row.querySelectorAll('.details-section .details-row');
            additionalDetails.forEach(detailRow => {
                detailRow.querySelector('.pure-name').classList.remove('error');
                detailRow.querySelector('.pure-qty').classList.remove('error');
                detailRow.querySelector('.pure-price').classList.remove('error');
                detailRow.querySelector('.pure-max-entries').classList.remove('error');
                detailRow.querySelector('.pure-discount').classList.remove('error');
            });

   // V√©rifier si la ligne principale est valide       
            const isRowValid = name.value.trim() && 
                              firstQty.value && 
                              firstPrice.value && 
                              (firstMaxEntries.dataset.maxEntries && firstMaxEntries.dataset.maxEntries !== '{}');

            if (isRowValid) {
                hasValidRow = true;

                additionalDetails.forEach((detailRow, detailIndex) => {
                    const nameDetail = detailRow.querySelector('.pure-name');
                    const qty = detailRow.querySelector('.pure-qty');
                    const price = detailRow.querySelector('.pure-price');
                    const maxEntries = detailRow.querySelector('.pure-max-entries');
                    const discount = detailRow.querySelector('.pure-discount');

                    if (!nameDetail.value.trim()) {
                        errors.push(`Veuillez remplir le champ "Nom" dans la ligne suppl√©mentaire ${detailIndex + 1} de la ligne ${index + 1}.`);
                        nameDetail.classList.add('error');
                    }
                    if (!qty.value) {
                        errors.push(`Veuillez remplir le champ "Qt. bouteilles" dans la ligne suppl√©mentaire ${detailIndex + 1} de la ligne ${index + 1}.`);
                        qty.classList.add('error');
                    }
                    if (!price.value) {
                        errors.push(`Veuillez remplir le champ "Prix" dans la ligne suppl√©mentaire ${detailIndex + 1} de la ligne ${index + 1}.`);
                        price.classList.add('error');
                    }
                    if (!maxEntries.dataset.maxEntries || maxEntries.dataset.maxEntries === '{}') {
                        errors.push(`Veuillez d√©finir "Max. Entr√©e" dans la ligne suppl√©mentaire ${detailIndex + 1} de la ligne ${index + 1}.`);
                        maxEntries.classList.add('error');
                    }
                });
            } else if (name.value.trim() || firstQty.value || firstPrice.value || firstMaxEntries.dataset.maxEntries || firstDiscount.value) {
                if (!name.value.trim()) {
                    errors.push(`Veuillez remplir le champ "Nom" dans la ligne ${index + 1}.`);
                    name.classList.add('error');
                }
                if (!firstQty.value) {
                    errors.push(`Veuillez remplir le champ "Qt. bouteilles" dans la ligne ${index + 1}.`);
                    firstQty.classList.add('error');
                }
                if (!firstPrice.value) {
                    errors.push(`Veuillez remplir le champ "Prix" dans la ligne ${index + 1}.`);
                    firstPrice.classList.add('error');
                }
                if (!firstMaxEntries.dataset.maxEntries || firstMaxEntries.dataset.maxEntries === '{}') {
                    errors.push(`Veuillez d√©finir "Max. Entr√©e" dans la ligne ${index + 1}.`);
                    firstMaxEntries.classList.add('error');
                }
            }
        });

        return { errors, hasValidRow };
    }

  // Fonction pour enregistrer une prestation
    function savePrestation() {
        const days = Array.from(document.querySelectorAll('input[name="days"]:checked')).map(checkbox => checkbox.value);
        const presentationLow = document.getElementById('access-presentation-low').value.trim();
        const presentationNormal = document.getElementById('access-presentation-normal').value.trim();
        const presentationAlcohol = document.getElementById('access-presentation-alcohol').value.trim();
        const presentationSoft = document.getElementById('access-presentation-soft').value.trim();
        const price = document.getElementById('access-price').value || '';
        const sex = document.getElementById('access-sex').value;
        let errors = [];
        const daysCheckboxes = document.getElementById('days-checkboxes');
        daysCheckboxes.classList.remove('error');
      // V√©rifier si au moins un jour est s√©lectionn√©
        if (days.length === 0) errors.push('Veuillez s√©lectionner au moins un jour.'), daysCheckboxes.classList.add('error');
        const accessValidation = validateAccessSoiree();
        errors = [...errors, ...accessValidation.errors];
        const { errors: pureErrors, hasValidRow: isPureValid } = validatePureSoiree();
        errors = [...errors, ...pureErrors];
    // V√©rifier si au moins une section est compl√®te  
        if (!accessValidation.isValid && !isPureValid) {
            errors.push('Veuillez remplir au moins une section compl√®te : "Les entr√©es" ou "Les entr√©es avec bouteille".');
            alert(errors.join('\n'));
            return;
        }
        if (errors.length > 0) {
            alert(errors.join('\n'));
            return;
        }
      // Construire l'objet des formules bouteille
        const pureItems = isPureValid ? Array.from(document.querySelectorAll('.pure-row')).map(row => {
            const category = row.querySelector('.pure-category-input').value.trim() || '';
            const firstDetail = {
                category: category,
                name: row.querySelector('.name-section .pure-name').value,
                qty: parseInt(row.querySelector('.name-section .pure-qty').value) || 1,
                price: parseFloat(row.querySelector('.name-section .pure-price').value) || 0,
                maxEntries: row.querySelector('.name-section .pure-max-entries').dataset.maxEntries ? JSON.parse(row.querySelector('.name-section .pure-max-entries').dataset.maxEntries) : { 1: 1 },
                discount: parseFloat(row.querySelector('.name-section .pure-discount').value) || 0
            };
            const additionalDetails = Array.from(row.querySelectorAll('.details-section .details-row')).map(detailRow => ({
                category: category,
                name: detailRow.querySelector('.pure-name').value,
                qty: parseInt(detailRow.querySelector('.pure-qty').value) || 1,
                price: parseFloat(detailRow.querySelector('.pure-price').value) || 0,
                maxEntries: detailRow.querySelector('.pure-max-entries').dataset.maxEntries ? JSON.parse(detailRow.querySelector('.pure-max-entries').dataset.maxEntries) : { 1: 1 },
                discount: parseFloat(detailRow.querySelector('.pure-discount').value) || 0
            }));
            return { details: [firstDetail, ...additionalDetails] };
        }) : [];
        const prestation = { days, presentationLow, presentationNormal, presentationAlcohol, presentationSoft, price: parseFloat(price) || 0, sex, pureItems };
        prestations.push(prestation);
        renderPrestations();
        renderKioskItems();
        resetForm();
    }

  // Fonction pour r√©initialiser le formulaire
    function resetForm() {
        document.querySelectorAll('input[name="days"]').forEach(checkbox => checkbox.checked = false);
        document.getElementById('access-presentation-low').value = '';
        document.getElementById('access-presentation-normal').value = '';
        document.getElementById('access-presentation-alcohol').value = '';
        document.getElementById('access-presentation-soft').value = '';
        document.getElementById('access-price').value = '';
        document.getElementById('access-sex').value = 'H/F';
        const pureContainer = document.getElementById('pure-container');
        pureContainer.innerHTML = '';
        addPure();
    }

  // Fonction pour ajouter des infobulles aux prestations
    function addTooltipsToPrestations() {
        const accessRows = document.querySelectorAll('.access-detail-row');
        const pureRows = document.querySelectorAll('.pure-detail-row');

        accessRows.forEach(row => {
            const prestationValue = row.querySelector('.prestation-value:nth-child(2)');
            if (prestationValue && prestationValue.scrollWidth > prestationValue.clientWidth) {
                prestationValue.setAttribute('title', prestationValue.textContent);
            }
        });

        pureRows.forEach(row => {
            const prestationLabel = row.querySelector('.prestation-value:nth-child(2)');
            const prestationValue = row.querySelector('.prestation-value:nth-child(3)');
            if (prestationLabel && prestationLabel.scrollWidth > prestationLabel.clientWidth) {
                prestationLabel.setAttribute('title', prestationLabel.textContent);
            }
            if (prestationValue && prestationValue.scrollWidth > prestationValue.clientWidth) {
                prestationValue.setAttribute('title', prestationValue.textContent);
            }
        });
    }

 // Fonction pour afficher les prestations 
function renderPrestations() {
    const accessList = document.getElementById('access-prestations-list');
    const pureList = document.getElementById('pure-prestations-list');
    const separatorLine = document.getElementById('separator-line');
    const previewSection = document.getElementById('preview-section');
    const accessForm = document.getElementById('access-form');
    const previewBtn = document.querySelector('.preview-btn');
    accessList.style.display = 'block';
    pureList.style.display = 'block';
    previewSection.style.display = 'none';
    accessForm.style.display = 'block';
    previewBtn.classList.remove('active');
    isPreviewActive = false;
    accessList.innerHTML = '';
    pureList.innerHTML = '';
    const filteredPrestations = selectedDayFilter ? prestations.filter(p => p.days.includes(selectedDayFilter)) : [...prestations];
    let hasAccess = false;
    let hasPure = false;

  // Afficher l'en-t√™te des acc√®s si n√©cessaire
    if (filteredPrestations.some(p => p.presentationLow || p.presentationNormal || p.presentationAlcohol || p.presentationSoft || p.price)) {
        accessList.innerHTML = `
            <div class="access-header-row">
                <div class="prestation-label">Les entr√©es:</div>
                <div class="prestation-label">Prestation:</div>
                <div class="prestation-label">Prix:</div>
                <div class="prestation-label">Sexe:</div>
                <div class="button-container"></div>
            </div>
        `;
    }

  // Afficher l'en-t√™te des formules bouteille si n√©cessaire
    if (filteredPrestations.some(p => p.pureItems.length > 0)) {
        pureList.innerHTML = `
            <div class="pure-header-row">
                <div class="prestation-label">Type:</div>
                <div class="prestation-label">Cat√©gorie:</div>
                <div class="prestation-label">Nom:</div>
                <div class="prestation-label">Qt:</div>
                <div class="prestation-label">Prix:</div>
                <div class="prestation-label">Max. Entr√©e:</div>
                <div class="prestation-label">R√©duc. Suppl.:</div>
                <div class="button-container"></div>
            </div>
        `;
    }

    filteredPrestations.forEach((prestation, index) => {
     // Afficher les acc√®s 
        if (prestation.presentationLow || prestation.presentationNormal || prestation.presentationAlcohol || prestation.presentationSoft || prestation.price) {
            hasAccess = true;
            const accessItem = document.createElement('div');
            accessItem.className = 'prestation-item';
            accessItem.draggable = true;
            accessItem.dataset.index = prestations.indexOf(prestation);
            const presentationRows = [];
            if (prestation.presentationLow) presentationRows.push({ access: 'Heure creuse', prestation: prestation.presentationLow, price: prestation.price, sex: prestation.sex });
            if (prestation.presentationNormal) presentationRows.push({ access: 'Entr√©e sans Boisson', prestation: prestation.presentationNormal, price: prestation.price, sex: prestation.sex });
            if (prestation.presentationAlcohol) presentationRows.push({ access: 'Entr√©e + Alcool', prestation: prestation.presentationAlcohol, price: prestation.price, sex: prestation.sex });
            if (prestation.presentationSoft) presentationRows.push({ access: 'Entr√©e + Soft', prestation: prestation.presentationSoft, price: prestation.price, sex: prestation.sex });
            const detailRows = presentationRows.map((row, rowIndex) => `
                <div class="access-detail-row ${rowIndex % 2 === 0 ? 'even-row' : 'odd-row'}" data-detail-index="${rowIndex}">
                    <div class="prestation-value">${row.access || '-'}</div>
                    <div class="prestation-value">${row.prestation || '-'}</div>
                    <div class="prestation-price">${row.price ? `${row.price}‚Ç¨` : '-'}</div>
                    <div class="prestation-value">${row.sex || '-'}</div>
                    <div class="button-container">
                        <button class="edit-btn" onclick="editPrestation(${prestations.indexOf(prestation)})">‚úèÔ∏è</button>
                        <button class="delete-btn" onclick="deletePrestation(${prestations.indexOf(prestation)})">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
            accessItem.innerHTML = detailRows;
            accessList.appendChild(accessItem);
        }

     // Afficher les formules bouteille 
        if (prestation.pureItems.length > 0) {
            hasPure = true;
            prestation.pureItems.forEach((pure, pureIndex) => {
                const pureItem = document.createElement('div');
                pureItem.className = 'prestation-item pure-item grid-support';
                pureItem.draggable = true;
                pureItem.dataset.index = prestations.indexOf(prestation);
                const detailRows = pure.details.map((detail, detailIndex) => {
                    const maxEntriesText = Object.entries(detail.maxEntries).map(([qty, max]) => `${qty}=${max}`).join(', ') || '-';
                    return `
                        <div class="pure-detail-row ${detailIndex % 2 === 0 ? 'even-row' : 'odd-row'}" data-detail-index="${detailIndex}">
                            <div class="prestation-label">Entr√©e bouteille:</div>
                            <div class="prestation-value">${detail.category || 'Aucune'}</div>
                            <div class="prestation-value">${detail.name || '-'}</div>
                            <div class="prestation-qty">${detail.qty || '-'}</div>
                            <div class="prestation-price">${detail.price ? `${detail.price}‚Ç¨` : '-'}</div>
                            <div class="prestation-max" data-tooltip="${maxEntriesText}">${maxEntriesText}</div>
                            <div class="prestation-discount">${detail.discount ? `${detail.discount}‚Ç¨` : '-'}</div>
                            <div class="button-container">
                                <button class="edit-btn" onclick="editPrestation(${prestations.indexOf(prestation)})">‚úèÔ∏è</button>
                                <button class="delete-btn" onclick="deletePrestation(${prestations.indexOf(prestation)})">üóëÔ∏è</button>
                            </div>
                        </div>
                    `;
                }).join('');
                pureItem.innerHTML = detailRows;
                pureList.appendChild(pureItem);
                pureItem.addEventListener('dragstart', handleDragStart);
                pureItem.addEventListener('dragover', handleDragOver);
                pureItem.addEventListener('drop', handleDrop);
                pureItem.addEventListener('dragend', handleDragEnd);
            });
        }
    });

    accessList.style.display = hasAccess ? 'block' : 'none';
    pureList.style.display = hasPure ? 'block' : 'none';
    separatorLine.style.display = (hasAccess && hasPure) ? 'block' : 'none';

    document.querySelectorAll('.prestation-item').forEach(item => {
        item.addEventListener('dragstart', handleDragStart);
        item.addEventListener('dragover', handleDragOver);
        item.addEventListener('drop', handleDrop);
        item.addEventListener('dragend', handleDragEnd);
    });

    document.querySelectorAll('.prestation-max').forEach(element => {
        const tooltipText = element.getAttribute('data-tooltip');
        if (element.scrollWidth > element.clientWidth) {
            element.addEventListener('mouseenter', showTooltip);
            element.addEventListener('mouseleave', hideTooltip);
            element.addEventListener('mousemove', positionTooltip);
        }
    });

    addTooltipsToPrestations();
}

 // Fonction pour afficher une infobulle au survol d'un √©l√©ment. 
    function showTooltip(e) {
        let tooltip = document.querySelector('.tooltip');
        if (!tooltip) {
            tooltip = document.createElement('div');
            tooltip.className = 'tooltip';
            document.body.appendChild(tooltip);
        }
        tooltip.textContent = this.getAttribute('data-tooltip');
        tooltip.classList.add('visible');
        positionTooltip.call(this, e);
    }

  // Fonction pour masquer l'infobulle lorsqu'on quitte l'√©l√©ment.
    function hideTooltip() {
        const tooltip = document.querySelector('.tooltip');
        if (tooltip) {
            tooltip.classList.remove('visible');
        }
    }

  // Fonction pour positionner l'infobulle en fonction de la souris et de la fen√™tre.
    function positionTooltip(e) {
        const tooltip = document.querySelector('.tooltip');
        if (!tooltip || !tooltip.classList.contains('visible')) return;

        const rect = this.getBoundingClientRect();
        const scrollX = window.scrollX || window.pageXOffset;
        const scrollY = window.scrollY || window.pageYOffset;

        let top = rect.bottom + scrollY + 5;
        let left = rect.left + scrollX + (rect.width / 2) - (tooltip.offsetWidth / 2);

        if (top + tooltip.offsetHeight > window.innerHeight + scrollY) {
            top = rect.top + scrollY - tooltip.offsetHeight - 5;
        }
        if (left < scrollX) left = scrollX + 5;
        if (left + tooltip.offsetWidth > window.innerWidth + scrollX) {
            left = window.innerWidth + scrollX - tooltip.offsetWidth - 5;
        }

        tooltip.style.top = `${top}px`;
        tooltip.style.left = `${left}px`;
    }

    let draggedItem = null;

  // Gestionnaire d'√©v√©nement d√©clench√© au d√©but du glisser d'un √©l√©ment.
    function handleDragStart(e) {
        draggedItem = this;
        this.classList.add('dragging');
        e.dataTransfer.effectAllowed = 'move';
        e.dataTransfer.setData('text/html', this.innerHTML);
    }

  // Gestionnaire d'√©v√©nement d√©clench√© lorsqu'un √©l√©ment est survol√© pendant le glisser.
    function handleDragOver(e) {
        e.preventDefault();
        e.dataTransfer.dropEffect = 'move';
    }

  // Gestionnaire d'√©v√©nement d√©clench√© lorsqu'un √©l√©ment est d√©pos√©.
    function handleDrop(e) {
        e.preventDefault();
        if (draggedItem !== this) {
            const allItems = [...document.querySelectorAll('.prestation-item')];
            const draggedIndex = parseInt(draggedItem.dataset.index);
            const droppedIndex = parseInt(this.dataset.index);
            const [movedItem] = prestations.splice(draggedIndex, 1);
            prestations.splice(droppedIndex, 0, movedItem);
            renderPrestations();
            renderKioskItems();
        }
    }

  // Gestionnaire d'√©v√©nement d√©clench√© √† la fin du glisser.
    function handleDragEnd() {
        this.classList.remove('dragging');
        draggedItem = null;
    }

  // Fonction pour filtrer les prestations par jour.
    function filterByDay(day) {
        const buttons = document.querySelectorAll('.day-btn');
        const previewBtn = document.querySelector('.preview-btn');
        buttons.forEach(btn => btn.classList.remove('active'));
        previewBtn.classList.remove('active');
        selectedDayFilter = (selectedDayFilter === day) ? null : day;
        if (selectedDayFilter) document.querySelector(`button[onclick="filterByDay('${day}')"]`).classList.add('active');
        isPreviewActive = false;
        renderPrestations();
    }

  // Fonction pour supprimer une prestation
    function deletePrestation(index) {
        prestations.splice(index, 1);
        renderPrestations();
        renderKioskItems();
    }

  // Fonction pour √©diter une prestation existante
    function editPrestation(index) {
        const prestation = prestations[index];
        document.querySelectorAll('input[name="days"]').forEach(checkbox => checkbox.checked = prestation.days.includes(checkbox.value));
        document.getElementById('access-presentation-low').value = prestation.presentationLow || '';
        document.getElementById('access-presentation-normal').value = prestation.presentationNormal || '';
        document.getElementById('access-presentation-alcohol').value = prestation.presentationAlcohol || '';
        document.getElementById('access-presentation-soft').value = prestation.presentationSoft || '';
        document.getElementById('access-price').value = prestation.price || '';
        document.getElementById('access-sex').value = prestation.sex;
        const pureContainer = document.getElementById('pure-container');
        pureContainer.innerHTML = '';
        prestation.pureItems.forEach(pure => {
            const pureDiv = document.createElement('div');
            pureDiv.className = 'pure-row';
            pureDiv.draggable = true;
            const firstDetail = pure.details[0] || { category: '', name: '', qty: '', price: '', maxEntries: { 1: 1 }, discount: 0 };
            const additionalDetails = pure.details.slice(1);
            pureDiv.innerHTML = `
                <div class="category-section">
                    <div>
                        <label>Cat√©gorie de bouteille (optionnel)</label>
                        <input type="text" list="bottle-categories" value="${firstDetail.category}" placeholder="Saisir ou s√©lectionner une cat√©gorie" class="pure-category-input">
                        <datalist id="bottle-categories">
                            <option value="VODKA">
                            <option value="WHISKY">
                            <option value="RUM">
                            <option value="J√ÑGERBOMB">
                            <option value="CHAMPAGNE">
                        </datalist>
                    </div>
                </div>
                <div class="name-section">
                    <div>
                        <label>Nom</label>
                        <input type="text" value="${firstDetail.name}" class="pure-name">
                    </div>
                    <div>
                        <label>Qt. bouteilles</label>
                        <input type="number" min="1" value="${firstDetail.qty}" class="pure-qty">
                    </div>
                    <div>
                        <label>Prix</label>
                        <input type="number" step="0.01" min="0" value="${firstDetail.price}" class="pure-price">
                    </div>
                    <div>
                        <label>Max. Entr√©e</label>
                        <input type="text" value="${Object.entries(firstDetail.maxEntries).map(([qty, max]) => `${qty}=${max}`).join(', ')}" class="pure-max-entries" readonly onclick="showMaxEntriesEditor(this)" data-max-entries='${JSON.stringify(firstDetail.maxEntries)}'>
                    </div>
                    <div>
                        <label>R√©duc. bouteille suppl.</label>
                        <input type="number" step="0.01" min="0" value="${firstDetail.discount}" class="pure-discount">
                    </div>
                    <button class="pure-duplicate-btn" onclick="duplicatePure(this)">üìã</button>
                    <button class="pure-delete-btn" onclick="deletePure(this)">üóëÔ∏è</button>
                </div>
                <div class="details-section">
                    ${additionalDetails.map(detail => `
                        <div class="details-row">
                            <div>
                                <label>Nom</label>
                                <input type="text" value="${detail.name}" class="pure-name">
                            </div>
                            <div>
                                <label>Qt. bouteilles</label>
                                <input type="number" min="1" value="${detail.qty}" class="pure-qty">
                            </div>
                            <div>
                                <label>Prix</label>
                                <input type="number" step="0.01" min="0" value="${detail.price}" class="pure-price">
                            </div>
                            <div>
                                <label>Max. Entr√©e</label>
                                <input type="text" value="${Object.entries(detail.maxEntries).map(([qty, max]) => `${qty}=${max}`).join(', ')}" class="pure-max-entries" readonly onclick="showMaxEntriesEditor(this)" data-max-entries='${JSON.stringify(detail.maxEntries)}'>
                            </div>
                            <div>
                                <label>R√©duc. bouteille suppl.</label>
                                <input type="number" step="0.01" min="0" value="${detail.discount}" class="pure-discount">
                            </div>
                            <button class="delete-details-btn" onclick="deleteDetails(this)">üóëÔ∏è</button>
                        </div>
                    `).join('')}
                    <button class="add-details-btn" onclick="addDetails(this)">+</button>
                </div>
            `;
            pureContainer.appendChild(pureDiv);
            addDragEvents(pureDiv);
        });
        if (pureContainer.children.length === 0) addPure();
        prestations.splice(index, 1);
        renderPrestations();
    }

  // Fonction pour afficher un aper√ßu des prestations par jour.
    function showPreview() {
        const previewSection = document.getElementById('preview-section');
        const accessList = document.getElementById('access-prestations-list');
        const pureList = document.getElementById('pure-prestations-list');
        const separatorLine = document.getElementById('separator-line');
        const accessForm = document.getElementById('access-form');
        const previewBtn = document.querySelector('.preview-btn');
        const buttons = document.querySelectorAll('.day-btn');
        accessList.style.display = 'none';
        pureList.style.display = 'none';
        separatorLine.style.display = 'none';
        accessForm.style.display = 'none';
        previewSection.style.display = 'block';
        previewBtn.classList.add('active');
        buttons.forEach(btn => btn.classList.remove('active'));
        selectedDayFilter = null;
        isPreviewActive = true;

        const daysOrder = ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi', 'Dimanche'];
        let html = '<table class="preview-table"><tr><th>Jour</th><th>Les entr√©es</th><th>Prestation</th><th>Cat√©gorie</th><th>Prix</th><th>Sexe</th><th>Qt. bouteilles</th><th>Max. Entr√©e</th><th>R√©duc. bouteille suppl.</th></tr>';

        daysOrder.forEach((day, dayIndex) => {
            const dayPrestations = prestations.filter(p => p.days.includes(day));
            const dayClass = `day-${day.toLowerCase()}`;
            if (dayPrestations.length > 0) {
                let allPresentationRows = [];
                let allPureRows = [];

                dayPrestations.forEach((prestation, prestationIndex) => {
                    if (prestation.presentationLow) {
                        allPresentationRows.push({
                            access: 'Heure creuse',
                            prestation: prestation.presentationLow,
                            price: prestation.price ? `${prestation.price}‚Ç¨` : '',
                            sex: prestation.sex,
                            category: '',
                            qty: '',
                            maxEntries: '',
                            discount: ''
                        });
                    }
                    if (prestation.presentationNormal) {
                        allPresentationRows.push({
                            access: 'Entr√©e sans Boisson',
                            prestation: prestation.presentationNormal,
                            price: prestation.price ? `${prestation.price}‚Ç¨` : '',
                            sex: prestation.sex,
                            category: '',
                            qty: '',
                            maxEntries: '',
                            discount: ''
                        });
                    }
                    if (prestation.presentationAlcohol) {
                        allPresentationRows.push({
                            access: 'Entr√©e + Alcool',
                            prestation: prestation.presentationAlcohol,
                            price: prestation.price ? `${prestation.price}‚Ç¨` : '',
                            sex: prestation.sex,
                            category: '',
                            qty: '',
                            maxEntries: '',
                            discount: ''
                        });
                    }
                    if (prestation.presentationSoft) {
                        allPresentationRows.push({
                            access: 'Entr√©e + Soft',
                            prestation: prestation.presentationSoft,
                            price: prestation.price ? `${prestation.price}‚Ç¨` : '',
                            sex: prestation.sex,
                            category: '',
                            qty: '',
                            maxEntries: '',
                            discount: ''
                        });
                    }

                    prestation.pureItems.forEach(pure => {
                        pure.details.forEach(detail => {
                            allPureRows.push({
                                access: 'Bouteille',
                                prestation: detail.name || '-',
                                price: detail.price ? `${detail.price}‚Ç¨` : '-',
                                sex: prestation.sex,
                                category: detail.category || '',
                                qty: detail.qty || '-',
                                maxEntries: Object.entries(detail.maxEntries).map(([qty, max]) => `${qty}=${max}`).join(', ') || '-',
                                discount: detail.discount ? `${detail.discount}‚Ç¨` : ''
                            });
                        });
                    });
                });

                const rowCount = allPresentationRows.length + allPureRows.length;
                let firstRowOfDay = true;

                allPresentationRows.forEach(row => {
                    html += `
                        <tr class="${dayClass}">
                            ${firstRowOfDay ? `<td class="day-cell" rowspan="${rowCount}" onclick="filterByDay('${day}')">${day}</td>` : ''}
                            <td>${row.access}</td>
                            <td>${row.prestation}</td>
                            <td>${row.category}</td>
                            <td>${row.price}</td>
                            <td>${row.sex}</td>
                            <td>${row.qty}</td>
                            <td>${row.maxEntries}</td>
                            <td>${row.discount}</td>
                        </tr>
                    `;
                    firstRowOfDay = false;
                });

                allPureRows.forEach(row => {
                    html += `
                        <tr class="${dayClass}">
                            ${firstRowOfDay ? `<td class="day-cell" rowspan="${rowCount}" onclick="filterByDay('${day}')">${day}</td>` : ''}
                            <td>${row.access}</td>
                            <td>${row.prestation}</td>
                            <td>${row.category}</td>
                            <td>${row.price}</td>
                            <td>${row.sex}</td>
                            <td>${row.qty}</td>
                            <td>${row.maxEntries}</td>
                            <td>${row.discount}</td>
                        </tr>
                    `;
                    firstRowOfDay = false;
                });
            } else {
                html += `<tr class="${dayClass}"><td class="day-cell" onclick="filterByDay('${day}')">${day}</td><td colspan="8">Aucune prestation</td></tr>`;
            }
        });

        html += '</table>';
        previewSection.innerHTML = html;
    }

    const today = new Date('2025-03-28'); // Date ajust√©e au 28 mars 2025
    const daysOfWeek = ["Dimanche", "Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi", "Samedi"];
    const currentDay = daysOfWeek[today.getDay()];
    document.getElementById('kiosk-subtitle').textContent = `Aujourd'hui : ${currentDay} ${today.toLocaleDateString('fr-FR')}`;

 // Fonction pour afficher les √©l√©ments du kiosque pour le jour actuel. 
    function renderKioskItems() {
        const accessContainer = document.getElementById('access-items');
        const pureContainer = document.getElementById('pure-items');
        const accessSection = document.getElementById('access-soiree');
        const pureSection = document.getElementById('pure-soiree');
        const separator = document.querySelector('.kiosk-separator');
        accessContainer.innerHTML = '';
        pureContainer.innerHTML = '';
        kioskItems = {};
        const todayPrestations = prestations.filter(p => p.days.includes(currentDay));
        let hasAccess = false;
        let hasPure = false;

        todayPrestations.forEach((prestation, prestationIndex) => {
            if (prestation.presentationLow || prestation.presentationNormal || 
                prestation.presentationAlcohol || prestation.presentationSoft) {
                hasAccess = true;
                const price = parseFloat(prestation.price) || 0;
                if (prestation.presentationLow) {
                    const id = `access-low-${prestationIndex}`;
                    kioskItems[id] = { name: prestation.presentationLow, price, qty: 0, maxQty: 1 };
                    accessContainer.innerHTML += `
                        <div class="kiosk-item">
                            <div class="kiosk-item-content">
                                <div class="kiosk-item-name">${prestation.presentationLow}</div>
                                <div class="kiosk-item-price-container">
                                    <div class="kiosk-item-price">${price}‚Ç¨</div>
                                </div>
                                <div class="kiosk-quantity-control">
                                    <button class="kiosk-qty-btn" data-id="${id}" data-action="decrease">-</button>
                                    <div id="${id}-qty" class="kiosk-qty-value">0</div>
                                    <button class="kiosk-qty-btn" data-id="${id}" data-action="increase">+</button>
                                </div>
                            </div>
                        </div>
                    `;
                }
              
  // Ajoute un √©l√©ment pour l'acc√®s "Entr√©e + Alcool" si d√©fini.       
if (prestation.presentationNormal) {
    const id = `access-normal-${prestationIndex}`;
    kioskItems[id] = { name: prestation.presentationNormal, price, qty: 0, maxQty: 10 };
    accessContainer.innerHTML += `
        <div class="kiosk-item">
            <div class="kiosk-item-content">
                <div class="kiosk-item-name">${prestation.presentationNormal}</div>
                <div class="kiosk-item-price-container">
                    <div class="kiosk-item-price">${price}‚Ç¨</div>
                </div>
                <div class="kiosk-quantity-control">
                    <button class="kiosk-qty-btn" data-id="${id}" data-action="decrease">-</button>
                    <div id="${id}-qty" class="kiosk-qty-value">0</div>
                    <button class="kiosk-qty-btn" data-id="${id}" data-action="increase">+</button>
                </div>
            </div>
        </div>
    `;
}
              
  // Ajoute un √©l√©ment pour l'acc√®s "Entr√©e + Soft" si d√©fini.         
if (prestation.presentationAlcohol) {
    const id = `access-alcohol-${prestationIndex}`;
    kioskItems[id] = { name: prestation.presentationAlcohol, price, qty: 0, maxQty: 10 };
    accessContainer.innerHTML += `
        <div class="kiosk-item">
            <div class="kiosk-item-content">
                <div class="kiosk-item-name">${prestation.presentationAlcohol}</div>
                <div class="kiosk-item-price-container">
                    <div class="kiosk-item-price">${price}‚Ç¨</div>
                </div>
                <div class="kiosk-quantity-control">
                    <button class="kiosk-qty-btn" data-id="${id}" data-action="decrease">-</button>
                    <div id="${id}-qty" class="kiosk-qty-value">0</div>
                    <button class="kiosk-qty-btn" data-id="${id}" data-action="increase">+</button>
                </div>
            </div>
        </div>
    `;
}
if (prestation.presentationSoft) {
    const id = `access-soft-${prestationIndex}`;
    kioskItems[id] = { name: prestation.presentationSoft, price, qty: 0, maxQty: 10 };
    accessContainer.innerHTML += `
        <div class="kiosk-item">
            <div class="kiosk-item-content">
                <div class="kiosk-item-name">${prestation.presentationSoft}</div>
                <div class="kiosk-item-price-container">
                    <div class="kiosk-item-price">${price}‚Ç¨</div>
                </div>
                <div class="kiosk-quantity-control">
                    <button class="kiosk-qty-btn" data-id="${id}" data-action="decrease">-</button>
                    <div id="${id}-qty" class="kiosk-qty-value">0</div>
                    <button class="kiosk-qty-btn" data-id="${id}" data-action="increase">+</button>
                </div>
            </div>
        </div>
    `;
}
            }

            if (prestation.pureItems.length > 0) {
                hasPure = true;
                const itemsByCategory = {};
                prestation.pureItems.forEach((pure, pureIndex) => {
                    pure.details.forEach((detail, detailIndex) => {
                        const category = detail.category || 'Sans cat√©gorie';
                        if (!itemsByCategory[category]) {
                            itemsByCategory[category] = [];
                        }
                        const id = `pure-${prestationIndex}-${pureIndex}-${detailIndex}`;
                        const maxQty = detail.maxEntries ? Math.max(...Object.keys(detail.maxEntries).map(Number)) : 1;
                        itemsByCategory[category].push({
                            id,
                            name: detail.name,
                            price: parseFloat(detail.price) || 0,
                            maxEntries: detail.maxEntries || { 1: 1 },
                            discount: parseFloat(detail.discount) || 0
                        });
                        kioskItems[id] = {
                            name: detail.name,
                            category: detail.category || '',
                            price: parseFloat(detail.price) || 0,
                            maxEntries: detail.maxEntries || { 1: 1 },
                            currentMaxEntries: detail.maxEntries[1] || 0,
                            discount: parseFloat(detail.discount) || 0,
                            qty: 0,
                            maxQty: maxQty
                        };
                    });
                });

                for (const [category, items] of Object.entries(itemsByCategory)) {
                    if (category && category !== 'Sans cat√©gorie') {
                        pureContainer.innerHTML += `
                            <div class="kiosk-item">
                                <div class="kiosk-item-category">${category}</div>
                            </div>
                        `;
                    }
                    items.forEach(item => {
                        const initialMax = item.maxEntries[1] || 0;
                        pureContainer.innerHTML += `
                            <div class="kiosk-item">
                                <div class="kiosk-item-content">
                                    <div class="kiosk-item-name">${item.name}</div>
                                    <div class="kiosk-item-price-container">
                                        <div class="kiosk-item-price">${item.price}‚Ç¨</div>
                                        <div class="kiosk-item-max" id="${item.id}-max-entries">Max. Entr√©es: <span class="kiosk-max-value">${initialMax}</span></div>
                                    </div>
                                    <div class="kiosk-quantity-control">
                                        <button class="kiosk-qty-btn" data-id="${item.id}" data-action="decrease">-</button>
                                        <div id="${item.id}-qty" class="kiosk-qty-value">0</div>
                                        <button class="kiosk-qty-btn" data-id="${item.id}" data-action="increase">+</button>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                }
            }
        });

        accessSection.style.display = hasAccess ? 'block' : 'none';
        pureSection.style.display = hasPure ? 'block' : 'none';
        separator.style.display = (hasAccess && hasPure) ? 'block' : 'none';

        attachKioskQuantityListeners();
        updateKioskTotal();
    }

  // Fonction pour attacher les gestionnaires d'√©v√©nements aux boutons de quantit√© du kiosque.
    function attachKioskQuantityListeners() {
        document.querySelectorAll('.kiosk-qty-btn').forEach(button => {
            button.removeEventListener('click', handleKioskQuantityClick);
            button.addEventListener('click', handleKioskQuantityClick);
        });
    }

  // Gestionnaire d'√©v√©nement pour les clics sur les boutons de quantit√©.
    function handleKioskQuantityClick() {
        const id = this.dataset.id;
        const action = this.dataset.action;
        updateKioskQuantity(id, action === 'increase' ? 1 : -1);
    }

  // Fonction pour mettre √† jour la quantit√© d'un √©l√©ment dans le kiosque.
    function updateKioskQuantity(itemId, change) {
        if (!kioskItems[itemId]) return;
        const item = kioskItems[itemId];
        const newQty = item.qty + change;
        if (newQty >= 0 && newQty <= item.maxQty) {
            item.qty = newQty;
            document.getElementById(`${itemId}-qty`).textContent = newQty;
            if (item.maxEntries) {
                item.currentMaxEntries = item.maxEntries[newQty] || item.currentMaxEntries;
                const maxEntriesElement = document.getElementById(`${itemId}-max-entries`);
                if (maxEntriesElement) {
                    maxEntriesElement.querySelector('.kiosk-max-value').textContent = item.currentMaxEntries || 0;
                }
            }
            updateKioskTotal();
        }
    }

  // Fonction pour calculer et afficher le total dans le kiosque.
    function updateKioskTotal() {
        let total = 0;
        let discountTotal = 0;
        let itemCount = 0;
        for (const item of Object.values(kioskItems)) {
            const price = parseFloat(item.price) || 0;
            const discount = parseFloat(item.discount) || 0;
            total += price * item.qty;
            const extraQty = Math.max(0, item.qty - 1);
            discountTotal += extraQty * discount;
            itemCount += item.qty;
        }
        document.getElementById('kiosk-total-discount').textContent = discountTotal > 0 ? `(R√©duc. bouteille suppl.: -${discountTotal.toFixed(2)}‚Ç¨)` : '';
        document.getElementById('kiosk-total-price').textContent = `${(total - discountTotal).toFixed(2)}‚Ç¨`;
        document.getElementById('kiosk-checkout-btn').disabled = itemCount === 0;
    }

    document.getElementById('kiosk-checkout-btn').addEventListener('click', () => {
        let summary = 'R√©servations :\n';
        let total = 0;
        let discountTotal = 0;
        for (const [id, item] of Object.entries(kioskItems)) {
            if (item.qty > 0) {
                const extraQty = Math.max(0, item.qty - 1);
                const itemDiscount = extraQty * item.discount;
                summary += `${item.name} x${item.qty} - ${(item.price * item.qty).toFixed(2)}‚Ç¨ (Max. Entr√©es: ${item.currentMaxEntries})`;
                if (itemDiscount > 0) summary += ` (R√©duc. bouteille suppl.: -${itemDiscount.toFixed(2)}‚Ç¨)`;
                summary += '\n';
                total += item.price * item.qty;
                discountTotal += itemDiscount;
            }
        }
        summary += `\nTotal: ${(total - discountTotal).toFixed(2)}‚Ç¨`;
        if (discountTotal > 0) summary += ` (dont r√©duction: -${discountTotal.toFixed(2)}‚Ç¨)`;
        alert(summary);
    });

  // Fonction pour basculer entre le tableau de bord et le kiosque.
    function toggleInterface() {
        const dashboard = document.getElementById('dashboard');
        const kiosk = document.getElementById('kiosk');
        const toggleBtn = document.getElementById('toggle-btn');
        if (dashboard.style.display === 'none') {
            dashboard.style.display = 'block';
            kiosk.style.display = 'none';
            toggleBtn.textContent = 'Passer au Kiosque';
        } else {
            dashboard.style.display = 'none';
            kiosk.style.display = 'block';
            toggleBtn.textContent = 'Passer au Tableau de Bord';
        }
    }
window.onload = () => {
    // Explicitly set initial display styles
    const dashboard = document.getElementById('dashboard');
    const kiosk = document.getElementById('kiosk');
    dashboard.style.display = 'block'; // Matches CSS .container { display: block; }
    kiosk.style.display = 'none';     // Matches CSS .kiosk-container { display: none; }

    addPure();
    renderKioskItems();
    document.querySelectorAll('.tooltip-icon').forEach(icon => {
        icon.addEventListener('mouseenter', showTooltip);
        icon.addEventListener('mouseleave', hideTooltip);
        icon.addEventListener('mousemove', positionTooltip);
    });
};
</script>
