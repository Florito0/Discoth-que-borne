<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des Tickets - Discoth√®que</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
        }
        
        body {
            background-color: #121212;
            color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            background-color: #1e1e1e;
            border-radius: 12px;
            width: 100%;
            max-width: 1000px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .header {
            background-color: #2c2c2c;
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #333;
        }
        
        h1 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .subtitle {
            font-size: 16px;
            color: #b3b3b3;
        }
        
        .tickets-section {
            padding: 20px;
        }
        
        .current-prestations {
            margin-bottom: 30px;
            padding: 15px;
            background: linear-gradient(135deg, #1c2526 0%, #2a3b4c 100%);
            border-radius: 8px;
        }
        
        .day-filter {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        .day-btn, .preview-btn {
            padding: 5px 10px;
            background: #444;
            border: 1px solid #333;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .day-btn:hover, .preview-btn:hover {
            background: #555; /* Plus clair au survol */
        }
        
        .day-btn.active, .preview-btn.active {
            background: linear-gradient(to right, #9733EE, #DA22FF);
            border: 1px solid #333;
        }
        
        .prestation-item {
            display: flex;
            flex-direction: column;
            padding: 10px;
            border-bottom: 1px solid #444;
            cursor: move;
            user-select: none;
        }
        
        .prestation-item.dragging {
            opacity: 0.5;
        }
        
        .prestation-item:last-child {
            border-bottom: none;
        }
        
        .prestation-details {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr 1fr 2fr 1fr;
            gap: 5px;
        }
        
        .prestation-details div {
            padding: 2px;
        }
        
        .prestation-options {
            display: flex;
            flex-direction: column;
        }
        
        .delete-btn {
            width: 32px;
            height: 32px;
            background-color: #ff4444;
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: box-shadow 0.3s, transform 0.3s;
            margin-left: 10px;
        }
        
        .delete-btn:hover {
            box-shadow: 0 0 10px #ff4444, 0 0 5px #00D4FF;
            transform: scale(1.1);
        }
        
        .delete-btn:active {
            transform: scale(0.95);
        }
        
        .edit-btn {
            width: 32px;
            height: 32px;
            background-color: #9733EE;
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: box-shadow 0.3s, transform 0.3s;
        }
        
        .edit-btn:hover {
            box-shadow: 0 0 10px #9733EE, 0 0 5px #00D4FF;
            transform: scale(1.1);
        }
        
        .edit-btn:active {
            transform: scale(0.95);
        }
        
        .ticket-form {
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        input, select {
            padding: 8px;
            background-color: #333;
            border: 1px solid #333;
            color: white;
            border-radius: 4px;
            width: 100%;
            max-width: 300px;
            transition: background-color 0.3s, box-shadow 0.3s;
        }
        
        input:hover, select:hover, input:focus, select:focus {
            background-color: #444; /* Couleur plus claire au survol/focus */
            box-shadow: 0 0 5px #00D4FF;
            outline: none;
        }
        
        .days-checkboxes {
            display: flex;
            gap: 15px;
            flex-wrap: nowrap;
            overflow-x: auto;
            padding: 5px;
        }
        
        .days-checkboxes.error {
            border: 2px solid #ff4444;
            border-radius: 4px;
        }
        
        .days-checkboxes label {
            display: flex;
            align-items: center;
            gap: 5px;
            white-space: nowrap;
        }
        
        .error input {
            border: 2px solid #ff4444;
        }
        
        .options-container {
            margin-top: 15px;
            padding-left: 20px;
        }
        
        .options-header {
            display: none;
            gap: 10px;
            margin-bottom: 10px;
            font-style: italic;
            font-size: 12px;
        }
        
        .options-header span {
            flex: 1;
            max-width: 150px;
            text-align: center;
        }
        
        .option-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
            align-items: center;
            cursor: move;
        }
        
        .option-row.dragging {
            opacity: 0.5;
        }
        
        .option-row input {
            max-width: 150px;
        }
        
        .option-delete-btn, .option-duplicate-btn {
            width: 24px;
            height: 24px;
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: box-shadow 0.3s, transform 0.3s;
        }
        
        .option-delete-btn {
            background-color: #ff4444;
        }
        
        .option-duplicate-btn {
            background-color: #4CAF50;
            margin-left: 5px;
        }
        
        .option-delete-btn:hover {
            box-shadow: 0 0 10px #ff4444, 0 0 5px #00D4FF;
            transform: scale(1.1);
        }
        
        .option-duplicate-btn:hover {
            box-shadow: 0 0 10px #4CAF50, 0 0 5px #00D4FF;
            transform: scale(1.1);
        }
        
        .option-delete-btn:active, .option-duplicate-btn:active {
            transform: scale(0.95);
        }
        
        .add-option-btn {
            background: #444;
            padding: 5px 10px;
            border: 1px solid #333;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
            transition: background-color 0.3s; /* Transition sur la couleur de fond */
        }
        
        .add-option-btn:hover {
            background: #555; /* Plus clair au survol */
        }
        
        .save-btn {
            padding: 15px;
            background: linear-gradient(to right, #9733EE, #DA22FF);
            color: white;
            border: 1px solid #333;
            border-radius: 6px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: box-shadow 0.3s;
            margin: 20px 0;
            width: 100%;
        }
        
        .save-btn:hover {
            box-shadow: 0 0 10px #9733EE, 0 0 5px #00D4FF;
        }
        
        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: linear-gradient(135deg, #2a3435 0%, #3b4c5d 100%);
            border: 1px solid #FF00FF;
        }
        
        .preview-table th, .preview-table td {
            padding: 10px;
            border: 1px solid #555;
            text-align: left;
        }
        
        .preview-table th {
            background-color: #444;
            font-weight: 700;
            border-bottom: 2px solid #00D4FF;
        }
        
        .preview-table td {
            vertical-align: top;
        }
        
        .preview-table .day-cell {
            cursor: pointer;
            transition: box-shadow 0.3s;
        }
        
        .preview-table .day-cell:hover {
            box-shadow: 0 0 5px #00D4FF;
        }
        
        .preview-table .day-lundi,
        .preview-table .day-mercredi,
        .preview-table .day-vendredi,
        .preview-table .day-dimanche {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .preview-table .day-mardi,
        .preview-table .day-jeudi,
        .preview-table .day-samedi {
            background-color: rgba(0, 0, 0, 0.05);
        }
        
        @media (max-width: 768px) {
            .option-row {
                flex-direction: column;
            }
            input, select {
                max-width: 100%;
            }
            .day-filter {
                gap: 5px;
            }
            .days-checkboxes {
                flex-wrap: nowrap;
                overflow-x: auto;
            }
            .prestation-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Gestion des Tickets</h1>
            <div class="subtitle">Configurez vos formules d'entr√©e</div>
        </div>
        
        <div class="tickets-section">
            <div class="current-prestations">
                <h2>Prestations actuelles</h2>
                <div class="day-filter" id="day-filter">
                    <button class="day-btn" onclick="filterByDay('Lundi')">Lundi</button>
                    <button class="day-btn" onclick="filterByDay('Mardi')">Mardi</button>
                    <button class="day-btn" onclick="filterByDay('Mercredi')">Mercredi</button>
                    <button class="day-btn" onclick="filterByDay('Jeudi')">Jeudi</button>
                    <button class="day-btn" onclick="filterByDay('Vendredi')">Vendredi</button>
                    <button class="day-btn" onclick="filterByDay('Samedi')">Samedi</button>
                    <button class="day-btn" onclick="filterByDay('Dimanche')">Dimanche</button>
                    <button class="preview-btn" onclick="showPreview()">Aper√ßu</button>
                </div>
                <div id="prestations-list">
                    <!-- Les prestations enregistr√©es appara√Ætront ici -->
                </div>
                <div id="preview-section" style="display: none;"></div>
            </div>
            
            <div class="ticket-form" id="ticket-form">
                <div class="form-group">
                    <label>Jour(s)</label>
                    <div class="days-checkboxes" id="days-checkboxes">
                        <label><input type="checkbox" name="days" value="Lundi"> Lundi</label>
                        <label><input type="checkbox" name="days" value="Mardi"> Mardi</label>
                        <label><input type="checkbox" name="days" value="Mercredi"> Mercredi</label>
                        <label><input type="checkbox" name="days" value="Jeudi"> Jeudi</label>
                        <label><input type="checkbox" name="days" value="Vendredi"> Vendredi</label>
                        <label><input type="checkbox" name="days" value="Samedi"> Samedi</label>
                        <label><input type="checkbox" name="days" value="Dimanche"> Dimanche</label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Pr√©sentation du ticket heure creuse</label>
                    <input type="text" placeholder="Ex: Entr√©e Gratuit" id="ticket-presentation-low">
                </div>
                
                <div class="form-group">
                    <label>Pr√©sentation du ticket normal</label>
                    <input type="text" placeholder="Ex: Entr√©e avec boisson" id="ticket-presentation-normal">
                </div>
                
                <div class="form-group">
                    <label>Prix (‚Ç¨)</label>
                    <input type="number" step="0.01" min="0" id="ticket-price">
                </div>
                
                <div class="form-group">
                    <label>Sexe</label>
                    <select id="ticket-sex">
                        <option value="Homme"><span style="color: #00D4FF;">‚ôÇ</span> Homme</option>
                        <option value="Femme"><span style="color: #FF00FF;">‚ôÄ</span> Femme</option>
                        <option value="H/F" selected><span style="color: #00D4FF;">‚ôÇ</span>/<span style="color: #FF00FF;">‚ôÄ</span> H/F</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Entr√©es max. par ticket</label>
                    <input type="number" min="1" id="ticket-max">
                </div>
                
                <div class="form-group">
                    <label>Options suppl√©mentaires</label>
                    <div class="options-header" id="options-header">
                        <span>Nom</span>
                        <span>Quantit√©</span>
                        <span>Prix</span>
                        <span>Max. personnes</span>
                    </div>
                    <div class="options-container" id="options-container">
                        <!-- Les options seront ajout√©es dynamiquement ici -->
                    </div>
                    <div class="add-option-btn" onclick="addOption()">+ Ajouter une option</div>
                </div>
            </div>
            
            <button class="save-btn" onclick="savePrestation()">Enregistrer les modifications</button>
        </div>
    </div>

    <script>
        let prestations = [];
        let selectedDayFilter = null;
        let isPreviewActive = false;

        function addOption() {
            const container = document.getElementById('options-container');
            const header = document.getElementById('options-header');
            header.style.display = 'flex';
            const optionDiv = document.createElement('div');
            optionDiv.className = 'option-row';
            optionDiv.draggable = true;
            optionDiv.innerHTML = `
                <input type="text" placeholder="Nom (ex: Bouteille)" class="option-name">
                <input type="number" min="1" placeholder="Quantit√©" class="option-qty">
                <input type="number" step="0.01" min="0" placeholder="Prix (‚Ç¨)" class="option-price">
                <input type="number" min="1" placeholder="Max. personnes" class="option-max-persons">
                <button class="option-duplicate-btn" onclick="duplicateOption(this)">üìã</button>
                <button class="option-delete-btn" onclick="deleteOption(this)">üóëÔ∏è</button>
            `;
            container.appendChild(optionDiv);
            addDragEvents(optionDiv);
        }

        function duplicateOption(button) {
            const container = document.getElementById('options-container');
            const originalRow = button.parentElement;
            const newRow = originalRow.cloneNode(true);
            newRow.querySelector('.option-duplicate-btn').onclick = () => duplicateOption(newRow.querySelector('.option-duplicate-btn'));
            newRow.querySelector('.option-delete-btn').onclick = () => deleteOption(newRow.querySelector('.option-delete-btn'));
            container.appendChild(newRow);
            addDragEvents(newRow);
        }

        function deleteOption(button) {
            const container = document.getElementById('options-container');
            button.parentElement.remove();
            if (container.children.length === 0) {
                document.getElementById('options-header').style.display = 'none';
            }
        }

        function addDragEvents(optionDiv) {
            optionDiv.addEventListener('dragstart', handleOptionDragStart);
            optionDiv.addEventListener('dragover', handleOptionDragOver);
            optionDiv.addEventListener('drop', handleOptionDrop);
            optionDiv.addEventListener('dragend', handleOptionDragEnd);
        }

        let draggedOption = null;

        function handleOptionDragStart(e) {
            draggedOption = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.innerHTML);
        }

        function handleOptionDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleOptionDrop(e) {
            e.preventDefault();
            if (draggedOption !== this) {
                const allOptions = [...document.querySelectorAll('.option-row')];
                const draggedIndex = allOptions.indexOf(draggedOption);
                const droppedIndex = allOptions.indexOf(this);
                const container = document.getElementById('options-container');
                const optionsArray = Array.from(container.children);

                const [movedOption] = optionsArray.splice(draggedIndex, 1);
                optionsArray.splice(droppedIndex, 0, movedOption);

                container.innerHTML = '';
                optionsArray.forEach(option => {
                    container.appendChild(option);
                    addDragEvents(option);
                });
            }
        }

        function handleOptionDragEnd() {
            this.classList.remove('dragging');
            draggedOption = null;
        }

        function savePrestation() {
            const days = Array.from(document.querySelectorAll('input[name="days"]:checked')).map(checkbox => checkbox.value);
            const presentationLow = document.getElementById('ticket-presentation-low').value.trim();
            const presentationNormal = document.getElementById('ticket-presentation-normal').value.trim();
            const sex = document.getElementById('ticket-sex').value;
            const price = document.getElementById('ticket-price').value || '';
            const maxEntries = document.getElementById('ticket-max').value || '';
            const options = Array.from(document.querySelectorAll('.option-row')).map(row => ({
                name: row.querySelector('.option-name').value,
                qty: row.querySelector('.option-qty').value,
                price: row.querySelector('.option-price').value,
                maxPersons: row.querySelector('.option-max-persons').value
            }));

            let errors = [];
            const daysCheckboxes = document.getElementById('days-checkboxes');
            const lowInput = document.getElementById('ticket-presentation-low');
            const normalInput = document.getElementById('ticket-presentation-normal');

            daysCheckboxes.classList.remove('error');
            lowInput.classList.remove('error');
            normalInput.classList.remove('error');

            if (days.length === 0) {
                errors.push('Veuillez s√©lectionner au moins un jour dans "Jour(s)".');
                daysCheckboxes.classList.add('error');
            }
            if (!presentationLow && !presentationNormal) {
                errors.push('Veuillez remplir au moins un champ parmi "Pr√©sentation du ticket heure creuse" ou "Pr√©sentation du ticket normal".');
                lowInput.classList.add('error');
                normalInput.classList.add('error');
            }
            if (presentationLow && presentationNormal) {
                errors.push('Veuillez remplir uniquement un champ entre "Pr√©sentation du ticket heure creuse" ou "Pr√©sentation du ticket normal".');
            }

            if (errors.length > 0) {
                alert(errors.join('\n'));
                return;
            }

            const prestation = { days, presentationLow, presentationNormal, sex, price, maxEntries, options };
            prestations.push(prestation);
            renderPrestations();
            resetForm();
        }

        function resetForm() {
            document.querySelectorAll('input[name="days"]').forEach(checkbox => checkbox.checked = false);
            document.getElementById('ticket-presentation-low').value = '';
            document.getElementById('ticket-presentation-normal').value = '';
            document.getElementById('ticket-sex').value = 'H/F';
            document.getElementById('ticket-price').value = '';
            document.getElementById('ticket-max').value = '';
            document.getElementById('options-container').innerHTML = '';
            document.getElementById('options-header').style.display = 'none';
            document.getElementById('days-checkboxes').classList.remove('error');
            document.getElementById('ticket-presentation-low').classList.remove('error');
            document.getElementById('ticket-presentation-normal').classList.remove('error');
        }

        function renderPrestations() {
            const list = document.getElementById('prestations-list');
            const previewSection = document.getElementById('preview-section');
            const ticketForm = document.getElementById('ticket-form');
            const previewBtn = document.querySelector('.preview-btn');
            list.style.display = 'block';
            previewSection.style.display = 'none';
            ticketForm.style.display = 'block';
            previewBtn.classList.remove('active');
            isPreviewActive = false;

            list.innerHTML = '';
            const filteredPrestations = selectedDayFilter 
                ? prestations.filter(p => p.days.includes(selectedDayFilter))
                : [...prestations];

            filteredPrestations.forEach((prestation, index) => {
                const item = document.createElement('div');
                item.className = 'prestation-item';
                item.draggable = true;
                item.dataset.index = index;

                const presentationText = [
                    prestation.presentationLow ? `Heure creuse: ${prestation.presentationLow}` : '',
                    prestation.presentationNormal ? `Normal: ${prestation.presentationNormal}` : ''
                ].filter(Boolean).join(' / ');
                const ticketText = presentationText.split(' / ')[0].split(': ')[0] || '';
                const prestationText = presentationText.split(': ')[1] || '';
                const maxEntriesText = prestation.maxEntries ? ` (${prestation.maxEntries})` : '';
                let optionsHtml = '';
                if (prestation.options.length > 0) {
                    optionsHtml = prestation.options.map(opt => 
                        `<div>${opt.name} (Qt√©: ${opt.qty}, Prix: ${opt.price}‚Ç¨, Max: ${opt.maxPersons})</div>`
                    ).join('');
                } else {
                    optionsHtml = '<div>Aucune</div>';
                }

                const labels = index === 0 ? `
                    <div>Ticket:<br>${ticketText}</div>
                    <div>Prestation:<br>${prestationText}</div>
                    <div>Prix:<br>${prestation.price}‚Ç¨${maxEntriesText}</div>
                    <div>Sexe:<br>${prestation.sex}</div>
                    <div class="prestation-options">Options:<br>${optionsHtml}</div>
                ` : `
                    <div>${ticketText}</div>
                    <div>${prestationText}</div>
                    <div>${prestation.price}‚Ç¨${maxEntriesText}</div>
                    <div>${prestation.sex}</div>
                    <div class="prestation-options">${optionsHtml}</div>
                `;

                item.innerHTML = `
                    <div class="prestation-details">
                        ${labels}
                        <div>
                            <button class="edit-btn" onclick="editPrestation(${index})">‚úèÔ∏è</button>
                            <button class="delete-btn" onclick="deletePrestation(${index})">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
                list.appendChild(item);
            });

            const items = list.querySelectorAll('.prestation-item');
            items.forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragover', handleDragOver);
                item.addEventListener('drop', handleDrop);
                item.addEventListener('dragend', handleDragEnd);
            });
        }

        let draggedItem = null;

        function handleDragStart(e) {
            draggedItem = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.innerHTML);
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDrop(e) {
            e.preventDefault();
            if (draggedItem !== this) {
                const allItems = [...document.querySelectorAll('.prestation-item')];
                const draggedIndex = parseInt(draggedItem.dataset.index);
                const droppedIndex = parseInt(this.dataset.index);
                const filteredPrestations = selectedDayFilter 
                    ? prestations.filter(p => p.days.includes(selectedDayFilter))
                    : [...prestations];
                
                const [movedItem] = filteredPrestations.splice(draggedIndex, 1);
                filteredPrestations.splice(droppedIndex, 0, movedItem);

                if (!selectedDayFilter) {
                    prestations = filteredPrestations;
                } else {
                    const originalIndices = allItems.map(item => parseInt(item.dataset.index));
                    const newPrestations = [];
                    filteredPrestations.forEach((item, i) => {
                        const origIndex = originalIndices[draggedIndex] === originalIndices[droppedIndex] 
                            ? originalIndices[droppedIndex] 
                            : originalIndices[i];
                        newPrestations[origIndex] = item;
                    });
                    prestations = newPrestations.filter(Boolean);
                }
                renderPrestations();
            }
        }

        function handleDragEnd() {
            this.classList.remove('dragging');
            draggedItem = null;
        }

        function filterByDay(day) {
            const buttons = document.querySelectorAll('.day-btn');
            const previewBtn = document.querySelector('.preview-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            previewBtn.classList.remove('active');
            if (selectedDayFilter === day) {
                selectedDayFilter = null;
            } else {
                selectedDayFilter = day;
                document.querySelector(`button[onclick="filterByDay('${day}')"]`).classList.add('active');
            }
            isPreviewActive = false;
            renderPrestations();
        }

        function deletePrestation(index) {
            const filteredIndex = prestations.findIndex((_, i) => i === index && (!selectedDayFilter || prestations[i].days.includes(selectedDayFilter)));
            prestations.splice(filteredIndex, 1);
            renderPrestations();
        }

        function editPrestation(index) {
            const filteredIndex = prestations.findIndex((_, i) => i === index && (!selectedDayFilter || prestations[i].days.includes(selectedDayFilter)));
            const prestation = prestations[filteredIndex];

            document.querySelectorAll('input[name="days"]').forEach(checkbox => {
                checkbox.checked = prestation.days.includes(checkbox.value);
            });
            document.getElementById('ticket-presentation-low').value = prestation.presentationLow || '';
            document.getElementById('ticket-presentation-normal').value = prestation.presentationNormal || '';
            document.getElementById('ticket-sex').value = prestation.sex;
            document.getElementById('ticket-price').value = prestation.price || '';
            document.getElementById('ticket-max').value = prestation.maxEntries || '';
            
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            const header = document.getElementById('options-header');
            header.style.display = prestation.options.length > 0 ? 'flex' : 'none';
            prestation.options.forEach(opt => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option-row';
                optionDiv.draggable = true;
                optionDiv.innerHTML = `
                    <input type="text" value="${opt.name}" class="option-name">
                    <input type="number" min="1" value="${opt.qty}" class="option-qty">
                    <input type="number" step="0.01" min="0" value="${opt.price}" class="option-price">
                    <input type="number" min="1" value="${opt.maxPersons}" class="option-max-persons">
                    <button class="option-duplicate-btn" onclick="duplicateOption(this)">üìã</button>
                    <button class="option-delete-btn" onclick="deleteOption(this)">üóëÔ∏è</button>
                `;
                optionsContainer.appendChild(optionDiv);
                addDragEvents(optionDiv);
            });

            prestations.splice(filteredIndex, 1);
            renderPrestations();
        }

        function showPreview() {
            const previewSection = document.getElementById('preview-section');
            const list = document.getElementById('prestations-list');
            const ticketForm = document.getElementById('ticket-form');
            const previewBtn = document.querySelector('.preview-btn');
            const buttons = document.querySelectorAll('.day-btn');

            list.style.display = 'none';
            ticketForm.style.display = 'none';
            previewSection.style.display = 'block';
            previewBtn.classList.add('active');
            buttons.forEach(btn => btn.classList.remove('active'));
            selectedDayFilter = null;
            isPreviewActive = true;

            const daysOrder = ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi', 'Dimanche'];
            let html = '<table class="preview-table"><tr><th>Jour</th><th>Ticket</th><th>Prestation</th><th>Prix</th><th>Sexe</th><th>Options</th></tr>';
            
            daysOrder.forEach((day, dayIndex) => {
                const dayPrestations = prestations.filter(p => p.days.includes(day));
                const dayClass = `day-${day.toLowerCase()}`;
                if (dayPrestations.length > 0) {
                    dayPrestations.forEach((prestation, index) => {
                        const presentationText = [
                            prestation.presentationLow ? `Heure creuse: ${prestation.presentationLow}` : '',
                            prestation.presentationNormal ? `Normal: ${prestation.presentationNormal}` : ''
                        ].filter(Boolean).join(' / ');
                        const ticketText = presentationText.split(' / ')[0].split(': ')[0] || '';
                        const prestationText = presentationText.split(': ')[1] || '';
                        let optionsHtml = '';
                        if (prestation.options.length > 0) {
                            optionsHtml = prestation.options.map(opt => 
                                `${opt.name} (Qt√©: ${opt.qty}, Prix: ${opt.price}‚Ç¨, Max: ${opt.maxPersons})`
                            ).join('<br>');
                        } else {
                            optionsHtml = 'Aucune';
                        }
                        html += `
                            <tr class="${dayClass}">
                                ${index === 0 ? `<td class="day-cell" onclick="filterByDay('${day}')">${day}</td>` : '<td></td>'}
                                <td>${ticketText}</td>
                                <td>${prestationText}</td>
                                <td>${prestation.price}‚Ç¨${prestation.maxEntries ? ` (${prestation.maxEntries})` : ''}</td>
                                <td>${prestation.sex}</td>
                                <td>${optionsHtml}</td>
                            </tr>
                        `;
                    });
                } else {
                    html += `<tr class="${dayClass}"><td class="day-cell" onclick="filterByDay('${day}')">${day}</td><td colspan="5">Aucune prestation</td></tr>`;
                }
            });
            
            html += '</table>';
            previewSection.innerHTML = html;
        }
    </script>
</body>
</html>
